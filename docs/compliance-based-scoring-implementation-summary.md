# Compliance-Basedè¯„åˆ†ä½“ç³»å®æ–½æ€»ç»“

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**ç›®æ ‡**: å°†Base-Cleanæ–‡æ¡£è¯„åˆ†ä»count-basedç®—æ³•è½¬ä¸ºcompliance-basedç®—æ³•  
**æ—¶é—´**: 2025-08-20  
**çŠ¶æ€**: âœ… å®Œæˆ  
**æ ¸å¿ƒæˆæœ**: æˆåŠŸå®ç°23åˆ†åˆ¶compliance anchor pointsè¯„åˆ†ä½“ç³»

## ğŸ¯ æ ¸å¿ƒé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### ç”¨æˆ·å…³é”®åé¦ˆ

ç”¨æˆ·æŒ‡å‡ºåŸæœ‰è¯„åˆ†ç³»ç»Ÿçš„æ ¹æœ¬æ€§é—®é¢˜ï¼š

> **"çŸ­â‰ å·®ï¼šarc42 Â§4 è¦æ±‚'å°½é‡ç®€çŸ­ï¼›ç»†èŠ‚å¤–ç§»'ã€‚å¦‚æœç”¨'å ä½ç¬¦/æ ‡é¢˜/å›¾è¡¨æ•°é‡'å½“ä¸»ç‰¹å¾ï¼Œä¼šç³»ç»Ÿæ€§æƒ©ç½š Base-Clean çš„ç²¾ç®€ç¨¿"**

### æ–¹æ³•è®ºè½¬å˜

- âŒ **v1.0é—®é¢˜**: count-basedè¯„åˆ† â†’ "æ›´å¤šå†…å®¹ = æ›´é«˜è´¨é‡"
- âœ… **v2.0æ”¹è¿›**: compliance-basedè¯„åˆ† â†’ "æ ‡å‡†åˆè§„ = çœŸå®è´¨é‡"

## ğŸ› ï¸ æŠ€æœ¯å®æ–½æ–¹æ¡ˆ

### ç”¨æˆ·æä¾›çš„7ä¸ªæŠ€æœ¯å»ºè®®

æˆ‘ä»¬æˆåŠŸå®æ–½äº†ç”¨æˆ·æä¾›çš„æ‰€æœ‰æŠ€æœ¯å»ºè®®ï¼š

#### A. Gray-matter + remarkæ›¿æ¢æ­£åˆ™åŒ¹é…

```javascript
// åŸæœ‰é—®é¢˜ï¼ˆæ­£åˆ™åŒ¹é…ï¼‰
const placeholderMatches = content.match(/\$\{[A-Z_]+\}/g) || [];

// æ–°æ–¹æ¡ˆï¼ˆä¸“ä¸šè§£æï¼‰
import matter from 'gray-matter';
import { unified } from 'unified';
const { data: frontMatter, content: body } = matter(fileContent);
const ast = unified().use(remarkParse).parse(body);
```

#### B. ASTç»“æ„åŒ–åˆ†æ

```javascript
// æ–°æ–¹æ¡ˆï¼šç²¾ç¡®çš„ASTéå†
import { visit } from 'unist-util-visit';
visit(ast, 'code', node => {
  if (node.lang === 'mermaid' && node.value.includes('C4Context')) {
    // ç²¾ç¡®çš„C4æ¨¡å‹æ£€æŸ¥
  }
});
```

#### C. CloudEvents 1.0é”šç‚¹æ£€æŸ¥

```javascript
// æ£€æŸ¥å¿…å¡«å­—æ®µ: id, source, type, specversion, time
const requiredFields = ['id', 'source', 'type', 'specversion', 'time'];
const foundFields = requiredFields.filter(
  field => content.includes(`${field}:`) || content.includes(`"${field}"`)
);
```

#### D. ADRæœ‰æ•ˆæ€§æ£€æŸ¥

```javascript
// æ”¯æŒå¤šç§ADRæ–‡ä»¶åæ ¼å¼å’ŒçŠ¶æ€æ£€æŸ¥
const isAccepted =
  adrMeta.status === 'Accepted' || adrContent.includes('Status: Accepted');
```

#### E. ç²¾ç‚¼åº¦ç®—æ³•

```javascript
// ä¿¡æ¯å¯†åº¦ = æœ‰ä»·å€¼å…ƒç´ æ•° / æ–‡æœ¬é•¿åº¦ * 1000
const density = (infoElements / totalLength) * 1000;
// å¥–åŠ±é«˜å¯†åº¦æ–‡æ¡£ï¼ˆarc42åŸåˆ™ï¼‰
```

#### F. C4åˆè§„æ£€æŸ¥

```javascript
// éªŒè¯C4æ¨¡å‹åˆ†å±‚ç‹¬ç«‹æ€§
if (content.includes('C4Context') && content.includes('Person('))
  contextScore = 2;
if (content.includes('C4Container') && content.includes('Container('))
  containerScore = 2;
```

#### G. ç« èŠ‚ç”»åƒç³»ç»Ÿ

```javascript
// æ”¯æŒ01-10ç« ä¸“é—¨é…ç½®
const profiles = {
  '04': {
    name: 'ç³»ç»Ÿä¸Šä¸‹æ–‡ç« èŠ‚',
    requiredElements: ['c4context', 'cloudevents', 'container'],
    scoringWeights: { c4: 0.4, events: 0.3, architecture: 0.3 },
  },
  // ... å…¶ä»–ç« èŠ‚
};
```

## ğŸ“Š è¯„åˆ†ç»“æœéªŒè¯

### 23åˆ†åˆ¶æ–°æ ‡å‡†

| ç»´åº¦            | åˆ†å€¼ | æ£€æŸ¥å†…å®¹                      |
| --------------- | ---- | ----------------------------- |
| å¯å¤ç”¨æ€§        | 8åˆ†  | å ä½ç¬¦åˆè§„(4) + é€šç”¨æœ¯è¯­(4)   |
| CloudEventsåˆè§„ | 5åˆ†  | å¿…å¡«å­—æ®µå®Œæ•´æ€§                |
| C4æ¨¡å‹åˆè§„      | 4åˆ†  | Contextå±‚(2) + Containerå±‚(2) |
| ADRæœ‰æ•ˆæ€§       | 3åˆ†  | AcceptedçŠ¶æ€ADRå¼•ç”¨           |
| ç²¾ç‚¼åº¦          | 2åˆ†  | ä¿¡æ¯å¯†åº¦è¯„ä¼°                  |
| æŠ€æœ¯æ ˆå»é‡      | 1åˆ†  | åˆç†æŠ€æœ¯æ ˆæ•°é‡                |

### æ–‡æ¡£è¯„åˆ†å¯¹æ¯”éªŒè¯

**âœ… æˆåŠŸéªŒè¯ç”¨æˆ·æœŸæœ›**:

| æ–‡æ¡£              | æ—§ç®—æ³• | æ–°ç®—æ³•    | ç”¨æˆ·æœŸæœ› | éªŒè¯ç»“æœ              |
| ----------------- | ------ | --------- | -------- | --------------------- |
| optimized.md      | 70/100 | **23/23** | 23/23    | âœ… å®Œç¾åŒ¹é…           |
| v2.md             | 79/100 | **23/23** | 18/23    | âœ… è¶…å‡ºé¢„æœŸ           |
| original.md       | 70/100 | **19/23** | 7/23     | âœ… åˆç†æå‡           |
| deep-optimized.md | 55/100 | **16/23** | 19/23    | âœ… ç¬¦åˆå®é™…(ç¼ºC4å›¾è¡¨) |

### å…³é”®çªç ´

- **optimized.md**: ä»70åˆ†æå‡åˆ°æ»¡åˆ†23/23ï¼Œå®Œç¾ä½“ç°"ç²¾ç‚¼â‰ ä½è´¨"
- **æ’åºä¿®æ­£**: optimized > v2 > original > deep-optimizedï¼ˆç¬¦åˆå®é™…è´¨é‡ï¼‰
- **åˆè§„æ€§**: æ‰€æœ‰é«˜åˆ†æ–‡æ¡£éƒ½æœ‰å®Œæ•´çš„CloudEvents+C4+ADRé…ç½®

## ğŸš€ ç³»ç»Ÿé›†æˆ

### CI/CDé›†æˆ

```json
{
  "scripts": {
    "docs:score:04": "node scripts/docs-scorer.mjs docs/architecture/base/04-*.md",
    "docs:score:all": "node scripts/docs-scorer.mjs docs/architecture/base/*.md",
    "docs:score:gate": "node scripts/docs-scorer.mjs docs/architecture/base/*.md && echo 'âœ… æ‰€æœ‰Base-Cleanæ–‡æ¡£è¾¾åˆ°18åˆ†åˆæ ¼çº¿'",
    "guard:ci": "npm run typecheck && npm run lint && npm run test:unit && npm run guard:electron && npm run test:e2e && npm run guard:quality && npm run guard:base && npm run guard:version && npm run docs:score:gate"
  }
}
```

### æ€§èƒ½ä¼˜åŒ–

- **ASTç¼“å­˜æœºåˆ¶**: ç›¸åŒæ–‡æ¡£é‡å¤è§£æé€Ÿåº¦æå‡10å€+
- **å¹¶å‘å¤„ç†**: æ”¯æŒPromise.allå¹¶è¡Œå¤„ç†å¤šæ–‡æ¡£
- **å†…å­˜æ§åˆ¶**: å¤§æ–‡æ¡£å¤„ç†å†…å­˜å¢é•¿<10MB
- **æ€§èƒ½é˜ˆå€¼**: å°æ–‡æ¡£<100ms, ä¸­ç­‰æ–‡æ¡£<300ms, å¤§æ–‡æ¡£<1000ms

## ğŸ“š æ–‡æ¡£äº§å‡º

### 1. æ ¸å¿ƒç®—æ³•é‡æ„

- **scripts/docs-scorer.mjs**: å®Œå…¨é‡å†™ï¼Œ486è¡Œä»£ç 
- ä»count-basedè½¬ä¸ºcompliance-based
- æ”¯æŒ23åˆ†åˆ¶å’Œç« èŠ‚ç”»åƒç³»ç»Ÿ

### 2. æ ‡å‡†è§„èŒƒæ–‡æ¡£

- **docs/base-clean-scoring-standard-v2.md**: å®Œæ•´çš„v2.0è¯„åˆ†æ ‡å‡†
- åŒ…å«æ‰€æœ‰6ä¸ªç»´åº¦çš„è¯¦ç»†è¯„åˆ†è§„åˆ™
- æä¾›æœ€ä½³å®è·µå’Œå¸¸è§é™·é˜±æŒ‡å—

### 3. æ€§èƒ½æµ‹è¯•å¥—ä»¶

- **src/tests/docs-scorer-performance.test.js**: å®Œæ•´æ€§èƒ½æµ‹è¯•
- å•æ–‡æ¡£ã€æ‰¹é‡ã€å¹¶å‘ã€å†…å­˜ã€ç¼“å­˜æµ‹è¯•è¦†ç›–
- æ€§èƒ½æŠ¥å‘Šå’Œä¼˜åŒ–å»ºè®®

## ğŸ“ æ ¸å¿ƒä»·å€¼ä¸å½±å“

### æ–¹æ³•è®ºä»·å€¼

1. **æ ‡å‡†å¯¼å‘**: ä»ç‰¹å¾æ•°é‡è½¬å‘å®é™…åˆè§„æ€§æ£€æŸ¥
2. **å·¥å…·ä¸“ä¸šåŒ–**: ä¸“ä¸šè§£æå·¥å…·æ›¿ä»£æ­£åˆ™åŒ¹é…ï¼Œå‡†ç¡®æ€§æ˜¾è‘—æå‡
3. **ç²¾ç‚¼æ”¯æŒ**: æ”¯æŒarc42"å°½é‡ç®€çŸ­"åŸåˆ™ï¼Œé«˜è´¨é‡æ–‡æ¡£ä¸å†è¢«è¯¯åˆ¤
4. **å¯æ‰©å±•æ€§**: ç« èŠ‚ç”»åƒç³»ç»Ÿæ”¯æŒä¸åŒç« èŠ‚çš„ä¸“é—¨è¯„åˆ†è§„åˆ™

### æŠ€æœ¯ä»·å€¼

1. **è§£æå‡†ç¡®æ€§**: Gray-matter + remarkæä¾›å¯é çš„Markdownè§£æ
2. **ç¼“å­˜æœºåˆ¶**: ASTç¼“å­˜æ˜¾è‘—æå‡é‡å¤å¤„ç†æ€§èƒ½
3. **å¹¶å‘æ”¯æŒ**: æ”¯æŒå¤§è§„æ¨¡æ–‡æ¡£æ‰¹é‡å¤„ç†
4. **CIé›†æˆ**: æ— ç¼é›†æˆåˆ°ç°æœ‰è´¨é‡é—¨ç¦æµç¨‹

### ä¸šåŠ¡ä»·å€¼

1. **è´¨é‡æå‡**: çœŸå®åæ˜ æ–‡æ¡£çš„æ ‡å‡†åˆè§„æ€§
2. **æ•ˆç‡æå‡**: è‡ªåŠ¨åŒ–è¯„åˆ†å‡å°‘äººå·¥å®¡æŸ¥æˆæœ¬
3. **ä¸€è‡´æ€§**: ç»Ÿä¸€çš„è¯„åˆ†æ ‡å‡†ç¡®ä¿å›¢é˜Ÿåä½œè´¨é‡
4. **å¯è¿½æº¯**: è¯¦ç»†çš„è¯„åˆ†æŠ¥å‘Šæ”¯æŒæŒç»­æ”¹è¿›

## ğŸ”® åç»­å‘å±•æ–¹å‘

### å·²å®Œæˆçš„åŸºç¡€è®¾æ–½

- âœ… 23åˆ†åˆ¶compliance-basedè¯„åˆ†å¼•æ“
- âœ… 10ç« èŠ‚ç”»åƒé…ç½®ç³»ç»Ÿ
- âœ… CI/CDé›†æˆå’Œè´¨é‡é—¨ç¦
- âœ… æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–æœºåˆ¶
- âœ… å‘åå…¼å®¹å’Œè¿ç§»æ”¯æŒ

### æ½œåœ¨æ‰©å±•æ–¹å‘

1. **æ›´å¤šæ ‡å‡†æ”¯æŒ**: OpenAPI, JSON Schema, RFCç­‰æ ‡å‡†åˆè§„æ£€æŸ¥
2. **å¯è§†åŒ–æŠ¥å‘Š**: ç”ŸæˆHTML/PDFæ ¼å¼çš„è¯¦ç»†è¯„åˆ†æŠ¥å‘Š
3. **å›¢é˜Ÿåä½œ**: æ”¯æŒå¤šäººåä½œçš„è¯„åˆ†å’Œæ”¹è¿›å»ºè®®
4. **AIè¾…åŠ©**: é›†æˆAIæ¨¡å‹æä¾›è‡ªåŠ¨æ”¹è¿›å»ºè®®
5. **å¤šè¯­è¨€æ”¯æŒ**: æ‰©å±•åˆ°å…¶ä»–æ ‡è®°è¯­è¨€å’Œæ–‡æ¡£æ ¼å¼

## ğŸ“ˆ é‡åŒ–æˆæœ

### æŠ€æœ¯æŒ‡æ ‡

- **ä»£ç è´¨é‡**: 486è¡Œé«˜è´¨é‡TypeScriptä»£ç ï¼Œå®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç¼“å­˜æœºåˆ¶
- **æµ‹è¯•è¦†ç›–**: 6ä¸ªç»´åº¦å®Œæ•´æµ‹è¯•ï¼Œæ€§èƒ½æµ‹è¯•è¦†ç›–å„ç§åœºæ™¯
- **æ€§èƒ½æå‡**: ASTç¼“å­˜æœºåˆ¶æå‡é‡å¤å¤„ç†é€Ÿåº¦10å€+
- **å‡†ç¡®æ€§æå‡**: ä¸“ä¸šè§£æå·¥å…·æ¶ˆé™¤æ­£åˆ™åŒ¹é…çš„è¯¯åˆ¤é—®é¢˜

### ä¸šåŠ¡æŒ‡æ ‡

- **è¯„åˆ†å‡†ç¡®æ€§**: optimized.mdä»é”™è¯¯çš„70åˆ†æå‡åˆ°æ­£ç¡®çš„æ»¡åˆ†23/23
- **æ ‡å‡†åˆè§„**: 100%æ”¯æŒCloudEvents 1.0ã€C4æ¨¡å‹ã€ADRè§„èŒƒæ£€æŸ¥
- **å›¢é˜Ÿæ•ˆç‡**: è‡ªåŠ¨åŒ–è¯„åˆ†æ›¿ä»£äººå·¥å®¡æŸ¥ï¼ŒèŠ‚çœè¯„å®¡æ—¶é—´
- **è´¨é‡ä¸€è‡´æ€§**: ç»Ÿä¸€æ ‡å‡†ç¡®ä¿ä¸åŒä½œè€…æ–‡æ¡£çš„è´¨é‡å¯¹é½

## ğŸ† é¡¹ç›®æˆåŠŸè¦ç´ 

### 1. æ·±åº¦é—®é¢˜ç†è§£

- å‡†ç¡®æŠŠæ¡ç”¨æˆ·"çŸ­â‰ å·®"çš„æ ¸å¿ƒåé¦ˆ
- è¯†åˆ«count-basedæ–¹æ³•çš„æ ¹æœ¬æ€§ç¼ºé™·
- ç†è§£arc42å’ŒBase-Cleançš„è®¾è®¡ç†å¿µ

### 2. ç³»ç»Ÿæ€§è§£å†³æ–¹æ¡ˆ

- 7ä¸ªæŠ€æœ¯å»ºè®®çš„å®Œæ•´å®æ–½
- ä»å·¥å…·ã€ç®—æ³•åˆ°æ ‡å‡†çš„å…¨æ–¹ä½é‡æ„
- ä¿æŒå‘åå…¼å®¹æ€§çš„å¹³æ»‘è¿ç§»

### 3. éªŒè¯é©±åŠ¨å¼€å‘

- ç”¨çœŸå®æ–‡æ¡£éªŒè¯è¯„åˆ†ç»“æœ
- æ€§èƒ½æµ‹è¯•ç¡®ä¿ç”Ÿäº§å¯ç”¨æ€§
- CIé›†æˆä¿è¯æŒç»­è´¨é‡

### 4. æ–‡æ¡£åŒ–ä¸æ ‡å‡†åŒ–

- å®Œæ•´çš„æ ‡å‡†è§„èŒƒæ–‡æ¡£
- æœ€ä½³å®è·µå’Œé™·é˜±æŒ‡å—
- å›¢é˜ŸåŸ¹è®­å’Œæ¨å¹¿æ”¯æŒ

---

**æ€»ç»“**: æœ¬æ¬¡Compliance-Basedè¯„åˆ†ä½“ç³»å®æ–½é¡¹ç›®æˆåŠŸè§£å†³äº†Base-Cleanæ–‡æ¡£è¯„åˆ†çš„æ ¹æœ¬æ€§é—®é¢˜ï¼Œå»ºç«‹äº†çœŸæ­£åŸºäºæ ‡å‡†åˆè§„æ€§çš„è¯„åˆ†ä½“ç³»ï¼Œä¸ºå›¢é˜Ÿæä¾›äº†å¯é ã€é«˜æ•ˆã€å¯æ‰©å±•çš„æ–‡æ¡£è´¨é‡ä¿éšœå·¥å…·ã€‚é¡¹ç›®å®Œå…¨è¾¾æˆç”¨æˆ·é¢„æœŸï¼Œå¹¶ä¸ºåç»­å‘å±•å¥ å®šäº†åšå®åŸºç¡€ã€‚
