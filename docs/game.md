# 《公会经理》桌面原型技术方案

## 1 项目背景

**目标**：单人6个月内完成跨平台桌面原型  
**平台**：Windows / macOS /Linux（离线优先）  
**核心玩法**：模拟经营 + 战斗模拟  
**参考原型**：steam平台游戏：football manager 2024
**关键关注**：

- 性能优化
- 代码可维护性
- TDD流程实施
- 后续AI与云存档扩展能力

## 2 技术栈选型

| 层次     | 选型              | 核心作用                   |
| -------- | ----------------- | -------------------------- |
| 桌面容器 | **Electron**      | 跨平台打包 & Node API 集成 |
| 游戏引擎 | **Phaser 3**      | WebGL渲染 & 场景管理       |
| UI框架   | **React 19**      | 复杂界面组件开发           |
| 构建工具 | **Vite**          | Dev服务器 & 生产打包       |
| 开发语言 | **TypeScript**    | 全栈强类型支持             |
| 数据服务 | Supabase/Postgres | 云存储 & 认证 (可选)       |
| 样式方案 | **Tailwind CSS**  | 原子化CSS开发              |
| 演示部署 | Vercel            | CDN & Edge函数支持         |

## 3 可行性分析

### 3.1 桌面容器对比

| 方案         | 优势                     | 劣势                                | 决策             |
| ------------ | ------------------------ | ----------------------------------- | ---------------- |
| **Electron** | 生态成熟，插件丰富       | 包体大(80-100MB)，内存高(200-400MB) | **原型阶段沿用** |
| Tauri        | 包体小(~90%)，内存<100MB | 生态弱，需学习Rust                  | Beta后评估迁移   |

### 3.2 引擎集成方案 Phaser 3 + React 集成

- **官方模板**：通过`EventBus`解耦Phaser场景与React UI
- **状态管理**：全局状态库(Zustand/Redux)避免每帧触发 React 重渲染
- **引擎状态**：Phaser 3进入长期维护，示例丰富适合快速落地

### 3.3 构建工具对比

| 工具     | 优势               | 适用场景     | 决策         |
| -------- | ------------------ | ------------ | ------------ |
| **Vite** | 冷启动/HMR速度领先 | 常规开发     | **继续使用** |
| Webpack  | 极端定制场景优势   | 特殊插件需求 | 暂不采用     |

### 3.4 语言策略

- **全栈TS优势**：
  - 共享接口类型定义
  - 避免Electron-Python桥接开销
  - JS生态满足AI/路径规划需求

### 3.5 AI行为建模方案

| 方法              | 特点               | 适用阶段   |
| ----------------- | ------------------ | ---------- |
| **FSM**           | 实现快，易状态爆炸 | 原型占位   |
| **Behavior Tree** | 层次化，易复用     | 中期战斗AI |
| **GOAP**          | 自主规划，高灵活度 | Beta后扩展 |

### 3.6 数据服务策略

- **Supabase定位**：Postgres + Auth + 存储一站式服务
- **实施路线**：
  1. 原型期：本地文件存档
  2. 扩展期：接入Supabase（云存档/排行榜）

### 3.7 引擎替代评估

| 引擎         | 优势               | 劣势                | 决策     |
| ------------ | ------------------ | ------------------- | -------- |
| **Phaser 3** | 功能完备，文档丰富 | 包体较大            | **采用** |
| Pixi.js      | 渲染高效，体积小   | 需自建场景/物理系统 | 暂不采用 |

## 4 架构与实现要点

### 核心架构

1.事件总线 + Store：EventBus 传递游戏事件，Zustand / Redux 存储关键数据。2.模块边界清晰：成员系统、战斗系统、存档服务各自封装，接口用 interface 定义。3.性能监控：Chrome Profiler 监测帧耗时；对象池、Bitmap 字体、合批渲染等常规优化。
4.TDD 流程：Jest 覆盖纯逻辑模块；CI 执行 eslint && npm test，防止回归。5.风险前置：先完成最小可玩循环，再迭代 Supabase、GOAP 等增强功能。6.外部挂载：尽可能使用json文件通过外部挂载方式完成游戏内数据载入。
