Run echo "(Full) Running complete E2E security tests, shard 1/4..."
(Full) Running complete E2E security tests, shard 1/4...
[dotenv@17.2.1] injecting env (2) from .env.cache-bust -- tip: ⚙️  enable debug logging with { debug: true }
[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000
[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

Running 17 tests using 1 worker, shard 1 of 4

[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[1/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:47:5 › Electron安全基线验证 - ADR-0002 › 1. BrowserWindow安全配置验证 › 主窗口安全配置合规检查
[electron-security-audit] › tests\e2e\security\electron-security.spec.ts:47:5 › Electron安全基线验证 - ADR-0002 › 1. BrowserWindow安全配置验证 › 主窗口安全配置合规检查
[Test] 启动Electron应用进行安全测试...

[launch] building application (npm run build)...


> gamedev-vitegame@0.1.4 build
> tsc -p electron && tsc -b && vite build && node scripts/ci/postbuild-electron-commonjs.mjs



vite v7.0.6 building for production...


transforming...


✓ 519 modules transformed.


rendering chunks...


computing gzip size...


dist/assets/computation.worker-CdC_Me8w.js      0.34 kB


dist/index.html                                 1.02 kB │ gzip:   0.50 kB
dist/assets/GameCanvas-9dvl0rtk.css             1.44 kB │ gzip:   0.50 kB
dist/assets/index-s1eoQOPF.css                  7.61 kB │ gzip:   1.97 kB
dist/assets/workerBridge-BosBcgwm.js            0.58 kB │ gzip:   0.34 kB │ map:      2.18 kB
dist/assets/PerfTestHarness-3nWT5k1Q.js         1.61 kB │ gzip:   0.80 kB │ map:      4.91 kB
dist/assets/GameCanvas-DELiIOCl.js              4.75 kB │ gzip:   1.82 kB │ map:     16.56 kB


dist/assets/LevelResultService-DTQld7En.js      6.56 kB │ gzip:   2.41 kB │ map:     23.36 kB
dist/assets/GameVerticalSlice-Ce7-AAOo.js       8.71 kB │ gzip:   3.37 kB │ map:     27.14 kB
dist/assets/vendor-BGWK_U8k.js                  9.60 kB │ gzip:   3.94 kB │ map:     31.25 kB
dist/assets/index-BMQ3lgLs.js                  24.35 kB │ gzip:   8.16 kB │ map:     80.81 kB
dist/assets/GameEngineAdapter-CHHJz73y.js      47.08 kB │ gzip:  12.21 kB │ map:    173.44 kB
dist/assets/react-vendor-B-ki-tkK.js          182.52 kB │ gzip:  57.24 kB │ map:    858.95 kB
dist/assets/sentry-4e2a9S-S.js                362.18 kB │ gzip: 120.67 kB │ map:  1,783.83 kB
dist/assets/phaser-Cz-9LJxY.js              1,478.63 kB │ gzip: 339.73 kB │ map: 10,169.96 kB


✓ built in 17.29s


[postbuild] dist-electron/package.json already commonjs


[postbuild] ensured .cjs duplicates for 0 files


[launch] CI mode: build cached for subsequent tests


=== Electron安全基线测试总结 ===

✅ BrowserWindow安全配置验证

✅ 导航与弹窗拦截验证

✅ CSP策略合规验证

✅ 运行时安全监控

✅ 安全综合评分100%


🛡️ ADR-0002 Electron安全基线验证完成！

[2/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:84:5 › Electron安全基线验证 - ADR-0002 › 1. BrowserWindow安全配置验证 › preload API白名单验证
[3/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:203:5 › Electron安全基线验证 - ADR-0002 › 2. 导航与弹窗拦截验证 › 外部导航应被拦截
[4/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:230:5 › Electron安全基线验证 - ADR-0002 › 2. 导航与弹窗拦截验证 › 新窗口打开控制验证
[5/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:245:5 › Electron安全基线验证 - ADR-0002 › 3. CSP策略合规验证 › 内联脚本应被CSP阻止
[6/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:299:5 › Electron安全基线验证 - ADR-0002 › 3. CSP策略合规验证 › 外部资源CSP策略验证
[7/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:361:5 › Electron安全基线验证 - ADR-0002 › 4. 运行时安全监控 › 应用基本功能正常
[8/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:405:5 › Electron安全基线验证 - ADR-0002 › 4. 运行时安全监控 › 性能影响评估
[9/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:443:5 › Electron安全基线验证 - ADR-0002 › 5. 安全综合评分 › 安全配置综合评分应为100%
[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  override existing env vars with { override: true }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[10/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:47:5 › Electron安全基线验证 - ADR-0002 › 1. BrowserWindow安全配置验证 › 主窗口安全配置合规检查 (retry #1)
[Test] 启动Electron应用进行安全测试...

[launch] CI mode: reusing existing build (cached)


=== Electron安全基线测试总结 ===

✅ BrowserWindow安全配置验证

✅ 导航与弹窗拦截验证

✅ CSP策略合规验证

✅ 运行时安全监控

✅ 安全综合评分100%


🛡️ ADR-0002 Electron安全基线验证完成！

  1) [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:47:5 › Electron安全基线验证 - ADR-0002 › 1. BrowserWindow安全配置验证 › 主窗口安全配置合规检查 

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\electron-security.spec.ts:27:31

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\electron-security.spec.ts:27:31

    attachment #1: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results\artifacts\security-electron-security-75e87-serWindow安全配置验证-主窗口安全配置合规检查-electron-security-audit-retry1\trace.zip
    Usage:

        npx playwright show-trace test-results\artifacts\security-electron-security-75e87-serWindow安全配置验证-主窗口安全配置合规检查-electron-security-audit-retry1\trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[11/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:84:5 › Electron安全基线验证 - ADR-0002 › 1. BrowserWindow安全配置验证 › preload API白名单验证 (retry #1)
[12/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:203:5 › Electron安全基线验证 - ADR-0002 › 2. 导航与弹窗拦截验证 › 外部导航应被拦截 (retry #1)
[13/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:230:5 › Electron安全基线验证 - ADR-0002 › 2. 导航与弹窗拦截验证 › 新窗口打开控制验证 (retry #1)
[14/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:245:5 › Electron安全基线验证 - ADR-0002 › 3. CSP策略合规验证 › 内联脚本应被CSP阻止 (retry #1)
[15/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:299:5 › Electron安全基线验证 - ADR-0002 › 3. CSP策略合规验证 › 外部资源CSP策略验证 (retry #1)
[16/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:361:5 › Electron安全基线验证 - ADR-0002 › 4. 运行时安全监控 › 应用基本功能正常 (retry #1)
[17/17] [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:405:5 › Electron安全基线验证 - ADR-0002 › 4. 运行时安全监控 › 性能影响评估 (retry #1)
[18/17] (retries) [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:443:5 › Electron安全基线验证 - ADR-0002 › 5. 安全综合评分 › 安全配置综合评分应为100% (retry #1)
[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: 📡 auto-backup env with Radar: https://dotenvx.com/radar

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[19/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:39:3 › CSP策略安全验证 › CSP应该阻止内联脚本执行
[electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:39:3 › CSP策略安全验证 › CSP应该阻止内联脚本执行
[launch] CI mode: reusing existing build (cached)

[20/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:59:3 › CSP策略安全验证 › CSP应该阻止不安全的外部资源
[21/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:75:3 › CSP策略安全验证 › CSP违规报告功能
[22/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:80:3 › CSP策略安全验证 › CSP 以响应头或<meta>其一存在即可
[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[23/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:39:3 › CSP策略安全验证 › CSP应该阻止内联脚本执行 (retry #1)
[launch] CI mode: reusing existing build (cached)

  2) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:39:3 › CSP策略安全验证 › CSP应该阻止内联脚本执行 

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:15:41

    TypeError: Cannot read properties of undefined (reading 'close')

      34 |
      35 |   test.afterAll(async () => {
    > 36 |     await electronApp.close();
         |                       ^
      37 |   });
      38 |
      39 |   test('CSP应该阻止内联脚本执行', async () => {
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:36:23

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:15:41

    TypeError: Cannot read properties of undefined (reading 'close')

      34 |
      35 |   test.afterAll(async () => {
    > 36 |     await electronApp.close();
         |                       ^
      37 |   });
      38 |
      39 |   test('CSP应该阻止内联脚本执行', async () => {
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:36:23

    attachment #1: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results\artifacts\security-enhanced-enhanced-db029-ity-CSP策略安全验证-CSP应该阻止内联脚本执行-electron-security-audit-retry1\trace.zip
    Usage:

        npx playwright show-trace test-results\artifacts\security-enhanced-enhanced-db029-ity-CSP策略安全验证-CSP应该阻止内联脚本执行-electron-security-audit-retry1\trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[24/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:59:3 › CSP策略安全验证 › CSP应该阻止不安全的外部资源 (retry #1)
[25/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:75:3 › CSP策略安全验证 › CSP违规报告功能 (retry #1)
[26/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:80:3 › CSP策略安全验证 › CSP 以响应头或<meta>其一存在即可 (retry #1)
[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  load multiple .env files with { path: ['.env.local', '.env'] }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[27/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:35:5 › Electron安全基线验证 › Isolation Basics › 渲染进程应该无法访问Node.js API
[electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:35:5 › Electron安全基线验证 › Isolation Basics › 渲染进程应该无法访问Node.js API
[launch] CI mode: reusing existing build (cached)

[28/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:47:5 › Electron安全基线验证 › Isolation Basics › 上下文隔离应该启用
[29/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:62:5 › Electron安全基线验证 › Isolation Basics › sandbox模式验证
[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[30/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:35:5 › Electron安全基线验证 › Isolation Basics › 渲染进程应该无法访问Node.js API (retry #1)
[launch] CI mode: reusing existing build (cached)

  3) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:35:5 › Electron安全基线验证 › Isolation Basics › 渲染进程应该无法访问Node.js API 

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:17:43

    TypeError: Cannot read properties of undefined (reading 'close')

      30 |
      31 |     test.afterAll(async () => {
    > 32 |       await electronApp.close();
         |                         ^
      33 |     });
      34 |
      35 |     test('渲染进程应该无法访问Node.js API', async () => {
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:32:25

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:17:43

    TypeError: Cannot read properties of undefined (reading 'close')

      30 |
      31 |     test.afterAll(async () => {
    > 32 |       await electronApp.close();
         |                         ^
      33 |     });
      34 |
      35 |     test('渲染进程应该无法访问Node.js API', async () => {
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:32:25

    attachment #1: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results\artifacts\security-enhanced-enhanced-7cc49-asics-渲染进程应该无法访问Node-js-API-electron-security-audit-retry1\trace.zip
    Usage:

        npx playwright show-trace test-results\artifacts\security-enhanced-enhanced-7cc49-asics-渲染进程应该无法访问Node-js-API-electron-security-audit-retry1\trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[31/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:47:5 › Electron安全基线验证 › Isolation Basics › 上下文隔离应该启用 (retry #1)
[32/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:62:5 › Electron安全基线验证 › Isolation Basics › sandbox模式验证 (retry #1)
[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  suppress all logs with { quiet: true }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[33/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:82:5 › Electron安全基线验证 › Preload Whitelist API › 应该只暴露白名单API
[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  override existing env vars with { override: true }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[34/17] (retries) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:82:5 › Electron安全基线验证 › Preload Whitelist API › 应该只暴露白名单API (retry #1)
  4) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:82:5 › Electron安全基线验证 › Preload Whitelist API › 应该只暴露白名单API 

    ReferenceError: page is not defined

      81 |   test.describe('Preload Whitelist API', () => {
      82 |     test('应该只暴露白名单API', async () => {
    > 83 |       const apiValidation = await page.evaluate(() => {
         |                             ^
      84 |         const electronAPI = (window as any).electronAPI;
      85 |
      86 |         // 在沙盒模式下，我们期望没有electronAPI暴露，这是安全的
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:83:29

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────

    ReferenceError: page is not defined

      81 |   test.describe('Preload Whitelist API', () => {
      82 |     test('应该只暴露白名单API', async () => {
    > 83 |       const apiValidation = await page.evaluate(() => {
         |                             ^
      84 |         const electronAPI = (window as any).electronAPI;
      85 |
      86 |         // 在沙盒模式下，我们期望没有electronAPI暴露，这是安全的
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:83:29

    attachment #1: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results\artifacts\security-enhanced-enhanced-8551b-d-Whitelist-API-应该只暴露白名单API-electron-security-audit-retry1\trace.zip
    Usage:

        npx playwright show-trace test-results\artifacts\security-enhanced-enhanced-8551b-d-Whitelist-API-应该只暴露白名单API-electron-security-audit-retry1\trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


Error:   1) [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:47:5 › Electron安全基线验证 - ADR-0002 › 1. BrowserWindow安全配置验证 › 主窗口安全配置合规检查 
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\electron-security.spec.ts:27:31
Error:   1) [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:47:5 › Electron安全基线验证 - ADR-0002 › 1. BrowserWindow安全配置验证 › 主窗口安全配置合规检查 

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\electron-security.spec.ts:27:31
Error:   2) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:39:3 › CSP策略安全验证 › CSP应该阻止内联脚本执行 
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:15:41
Error:   2) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:39:3 › CSP策略安全验证 › CSP应该阻止内联脚本执行 
    TypeError: Cannot read properties of undefined (reading 'close')

      34 |
      35 |   test.afterAll(async () => {
    > 36 |     await electronApp.close();
         |                       ^
      37 |   });
      38 |
      39 |   test('CSP应该阻止内联脚本执行', async () => {
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:36:23
Error:   2) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:39:3 › CSP策略安全验证 › CSP应该阻止内联脚本执行 

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:15:41
Error:   2) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:39:3 › CSP策略安全验证 › CSP应该阻止内联脚本执行 

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    TypeError: Cannot read properties of undefined (reading 'close')

      34 |
      35 |   test.afterAll(async () => {
    > 36 |     await electronApp.close();
         |                       ^
      37 |   });
      38 |
      39 |   test('CSP应该阻止内联脚本执行', async () => {
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:36:23
Error:   3) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:35:5 › Electron安全基线验证 › Isolation Basics › 渲染进程应该无法访问Node.js API 
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:17:43
Error:   3) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:35:5 › Electron安全基线验证 › Isolation Basics › 渲染进程应该无法访问Node.js API 
    TypeError: Cannot read properties of undefined (reading 'close')

      30 |
      31 |     test.afterAll(async () => {
    > 32 |       await electronApp.close();
         |                         ^
      33 |     });
      34 |
      35 |     test('渲染进程应该无法访问Node.js API', async () => {
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:32:25
Error:   3) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:35:5 › Electron安全基线验证 › Isolation Basics › 渲染进程应该无法访问Node.js API 

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:17:43
Error:   3) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:35:5 › Electron安全基线验证 › Isolation Basics › 渲染进程应该无法访问Node.js API 

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    TypeError: Cannot read properties of undefined (reading 'close')

      30 |
      31 |     test.afterAll(async () => {
    > 32 |       await electronApp.close();
         |                         ^
      33 |     });
      34 |
      35 |     test('渲染进程应该无法访问Node.js API', async () => {
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:32:25
Error:   4) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:82:5 › Electron安全基线验证 › Preload Whitelist API › 应该只暴露白名单API 
    ReferenceError: page is not defined

      81 |   test.describe('Preload Whitelist API', () => {
      82 |     test('应该只暴露白名单API', async () => {
    > 83 |       const apiValidation = await page.evaluate(() => {
         |                             ^
      84 |         const electronAPI = (window as any).electronAPI;
      85 |
      86 |         // 在沙盒模式下，我们期望没有electronAPI暴露，这是安全的
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:83:29
Error:   4) [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:82:5 › Electron安全基线验证 › Preload Whitelist API › 应该只暴露白名单API 

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    ReferenceError: page is not defined

      81 |   test.describe('Preload Whitelist API', () => {
      82 |     test('应该只暴露白名单API', async () => {
    > 83 |       const apiValidation = await page.evaluate(() => {
         |                             ^
      84 |         const electronAPI = (window as any).electronAPI;
      85 |
      86 |         // 在沙盒模式下，我们期望没有electronAPI暴露，这是安全的
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:83:29
Notice:   4 failed
    [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:47:5 › Electron安全基线验证 - ADR-0002 › 1. BrowserWindow安全配置验证 › 主窗口安全配置合规检查 
    [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:39:3 › CSP策略安全验证 › CSP应该阻止内联脚本执行 
    [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:35:5 › Electron安全基线验证 › Isolation Basics › 渲染进程应该无法访问Node.js API 
    [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:82:5 › Electron安全基线验证 › Preload Whitelist API › 应该只暴露白名单API 
  13 did not run
  4 failed
    [electron-security-audit] › tests\e2e\security\electron-security.spec.ts:47:5 › Electron安全基线验证 - ADR-0002 › 1. BrowserWindow安全配置验证 › 主窗口安全配置合规检查 
    [electron-security-audit] › tests\e2e\security\enhanced\enhanced-csp-security.spec.ts:39:3 › CSP策略安全验证 › CSP应该阻止内联脚本执行 
    [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:35:5 › Electron安全基线验证 › Isolation Basics › 渲染进程应该无法访问Node.js API 
    [electron-security-audit] › tests\e2e\security\enhanced\enhanced-electron-security.spec.ts:82:5 › Electron安全基线验证 › Preload Whitelist API › 应该只暴露白名单API 
  13 did not run
Error: Process completed with exit code 1.


Run echo "(Full) Running complete E2E security tests, shard 2/4..."
(Full) Running complete E2E security tests, shard 2/4...
[dotenv@17.2.1] injecting env (2) from .env.cache-bust -- tip: ⚙️  suppress all logs with { quiet: true }
[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000
[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

Running 13 tests using 1 worker, shard 2 of 4

[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  enable debug logging with { debug: true }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[1/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:46:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 地理位置权限应被默认拒绝
[electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:46:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 地理位置权限应被默认拒绝
[RedLine] 启动Electron应用进行红线安全测试...

[launch] building application (npm run build)...


> gamedev-vitegame@0.1.4 build
> tsc -p electron && tsc -b && vite build && node scripts/ci/postbuild-electron-commonjs.mjs



vite v7.0.6 building for production...


transforming...


✓ 519 modules transformed.


rendering chunks...


computing gzip size...


dist/assets/computation.worker-CdC_Me8w.js      0.34 kB


dist/index.html                                 1.02 kB │ gzip:   0.50 kB
dist/assets/GameCanvas-9dvl0rtk.css             1.44 kB │ gzip:   0.50 kB
dist/assets/index-s1eoQOPF.css                  7.61 kB │ gzip:   1.97 kB
dist/assets/workerBridge-BosBcgwm.js            0.58 kB │ gzip:   0.34 kB │ map:      2.18 kB
dist/assets/PerfTestHarness-3nWT5k1Q.js         1.61 kB │ gzip:   0.80 kB │ map:      4.91 kB
dist/assets/GameCanvas-DELiIOCl.js              4.75 kB │ gzip:   1.82 kB │ map:     16.56 kB


dist/assets/LevelResultService-DTQld7En.js      6.56 kB │ gzip:   2.41 kB │ map:     23.36 kB
dist/assets/GameVerticalSlice-Ce7-AAOo.js       8.71 kB │ gzip:   3.37 kB │ map:     27.14 kB
dist/assets/vendor-BGWK_U8k.js                  9.60 kB │ gzip:   3.94 kB │ map:     31.25 kB
dist/assets/index-BMQ3lgLs.js                  24.35 kB │ gzip:   8.16 kB │ map:     80.81 kB
dist/assets/GameEngineAdapter-CHHJz73y.js      47.08 kB │ gzip:  12.21 kB │ map:    173.44 kB
dist/assets/react-vendor-B-ki-tkK.js          182.52 kB │ gzip:  57.24 kB │ map:    858.95 kB


dist/assets/sentry-4e2a9S-S.js                362.18 kB │ gzip: 120.67 kB │ map:  1,783.83 kB
dist/assets/phaser-Cz-9LJxY.js              1,478.63 kB │ gzip: 339.73 kB │ map: 10,169.96 kB


✓ built in 17.26s


[postbuild] dist-electron/package.json already commonjs


[postbuild] ensured .cjs duplicates for 0 files


[launch] CI mode: build cached for subsequent tests


🔴 === 安全红线测试完成 ===

✅ 权限请求拦截验证完成

✅ 外部导航拦截验证完成

✅ 窗口打开拦截验证完成

🛡️ 三大安全红线全部通过！

[2/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:89:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 摄像头权限应被默认拒绝
[3/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:135:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 麦克风权限应被默认拒绝
[4/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:182:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 通知权限应被控制
[5/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:227:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线2: 外部导航拦截 (强制阻断) › window.location.href外部导航应被阻止
[6/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:269:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线2: 外部导航拦截 (强制阻断) › window.open外部导航应被阻止
[7/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:321:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线2: 外部导航拦截 (强制阻断) › 表单外部提交应被阻止
[8/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:369:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线3: 新窗口打开拦截 (零容忍) › 所有window.open调用都应被阻止
[9/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:477:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线3: 新窗口打开拦截 (零容忍) › 弹窗事件监听验证
[10/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:534:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线3: 新窗口打开拦截 (零容忍) › iframe弹窗尝试应被阻止
[11/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:616:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线综合验证 › 安全拦截功能不影响正常应用功能
[12/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:661:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线综合验证 › 红线拦截性能影响评估
[13/13] [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:713:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线综合验证 › 红线配置完整性检查
[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  override existing env vars with { override: true }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[14/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:46:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 地理位置权限应被默认拒绝 (retry #1)
[RedLine] 启动Electron应用进行红线安全测试...

[launch] CI mode: reusing existing build (cached)


🔴 === 安全红线测试完成 ===

✅ 权限请求拦截验证完成

✅ 外部导航拦截验证完成

✅ 窗口打开拦截验证完成

🛡️ 三大安全红线全部通过！

  1) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:46:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 地理位置权限应被默认拒绝 

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchAppWithPage (D:\a\myguild\myguild\tests\helpers\launch.ts:202:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\security-redlines.spec.ts:21:31

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchAppWithPage (D:\a\myguild\myguild\tests\helpers\launch.ts:202:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\security-redlines.spec.ts:21:31

    attachment #1: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results\artifacts\security-enhanced-security-d3f20-线1-权限请求拦截-默认拒绝-地理位置权限应被默认拒绝-electron-security-audit-retry1\trace.zip
    Usage:

        npx playwright show-trace test-results\artifacts\security-enhanced-security-d3f20-线1-权限请求拦截-默认拒绝-地理位置权限应被默认拒绝-electron-security-audit-retry1\trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[15/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:89:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 摄像头权限应被默认拒绝 (retry #1)
[16/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:135:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 麦克风权限应被默认拒绝 (retry #1)
[17/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:182:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 通知权限应被控制 (retry #1)
[18/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:227:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线2: 外部导航拦截 (强制阻断) › window.location.href外部导航应被阻止 (retry #1)
[19/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:269:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线2: 外部导航拦截 (强制阻断) › window.open外部导航应被阻止 (retry #1)
[20/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:321:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线2: 外部导航拦截 (强制阻断) › 表单外部提交应被阻止 (retry #1)
[21/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:369:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线3: 新窗口打开拦截 (零容忍) › 所有window.open调用都应被阻止 (retry #1)
[22/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:477:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线3: 新窗口打开拦截 (零容忍) › 弹窗事件监听验证 (retry #1)
[23/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:534:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线3: 新窗口打开拦截 (零容忍) › iframe弹窗尝试应被阻止 (retry #1)
[24/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:616:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线综合验证 › 安全拦截功能不影响正常应用功能 (retry #1)
[25/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:661:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线综合验证 › 红线拦截性能影响评估 (retry #1)
[26/13] (retries) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:713:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线综合验证 › 红线配置完整性检查 (retry #1)
Error:   1) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:46:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 地理位置权限应被默认拒绝 
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchAppWithPage (D:\a\myguild\myguild\tests\helpers\launch.ts:202:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\security-redlines.spec.ts:21:31
Error:   1) [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:46:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 地理位置权限应被默认拒绝 

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchAppWithPage (D:\a\myguild\myguild\tests\helpers\launch.ts:202:16)
        at D:\a\myguild\myguild\tests\e2e\security\enhanced\security-redlines.spec.ts:21:31
Notice:   1 failed
    [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:46:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 地理位置权限应被默认拒绝 
  12 did not run
  1 failed
    [electron-security-audit] › tests\e2e\security\enhanced\security-redlines.spec.ts:46:5 › 🔴 Electron安全红线测试 - ADR-0002核心拦截 › 红线1: 权限请求拦截 (默认拒绝) › 地理位置权限应被默认拒绝 
  12 did not run
Error: Process completed with exit code 1.

Run echo "(Full) Running complete E2E security tests, shard 4/4..."
(Full) Running complete E2E security tests, shard 4/4...
[dotenv@17.2.1] injecting env (2) from .env.cache-bust -- tip: 🔐 prevent building .env in docker: https://dotenvx.com/prebuild
[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000
[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

Running 13 tests using 1 worker, shard 4 of 4

[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  specify custom .env file path with { path: '/custom/path/.env' }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[1/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:43:3 › 🚫 红线用例 1: 导航拦截（默认拒绝） › 外部导航应被拦截 - window.location.href
[electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:43:3 › 🚫 红线用例 1: 导航拦截（默认拒绝） › 外部导航应被拦截 - window.location.href
🚀 启动 Electron 应用进行安全红线测试...

[launch] building application (npm run build)...


> gamedev-vitegame@0.1.4 build
> tsc -p electron && tsc -b && vite build && node scripts/ci/postbuild-electron-commonjs.mjs



vite v7.0.6 building for production...


transforming...


✓ 519 modules transformed.


rendering chunks...


computing gzip size...


dist/assets/computation.worker-CdC_Me8w.js      0.34 kB


dist/index.html                                 1.02 kB │ gzip:   0.50 kB
dist/assets/GameCanvas-9dvl0rtk.css             1.44 kB │ gzip:   0.50 kB


dist/assets/index-s1eoQOPF.css                  7.61 kB │ gzip:   1.97 kB


dist/assets/workerBridge-BosBcgwm.js            0.58 kB │ gzip:   0.34 kB │ map:      2.18 kB
dist/assets/PerfTestHarness-3nWT5k1Q.js         1.61 kB │ gzip:   0.80 kB │ map:      4.91 kB
dist/assets/GameCanvas-DELiIOCl.js              4.75 kB │ gzip:   1.82 kB │ map:     16.56 kB
dist/assets/LevelResultService-DTQld7En.js      6.56 kB │ gzip:   2.41 kB │ map:     23.36 kB


dist/assets/GameVerticalSlice-Ce7-AAOo.js       8.71 kB │ gzip:   3.37 kB │ map:     27.14 kB
dist/assets/vendor-BGWK_U8k.js                  9.60 kB │ gzip:   3.94 kB │ map:     31.25 kB
dist/assets/index-BMQ3lgLs.js                  24.35 kB │ gzip:   8.16 kB │ map:     80.81 kB


dist/assets/GameEngineAdapter-CHHJz73y.js      47.08 kB │ gzip:  12.21 kB │ map:    173.44 kB


dist/assets/react-vendor-B-ki-tkK.js          182.52 kB │ gzip:  57.24 kB │ map:    858.95 kB
dist/assets/sentry-4e2a9S-S.js                362.18 kB │ gzip: 120.67 kB │ map:  1,783.83 kB


dist/assets/phaser-Cz-9LJxY.js              1,478.63 kB │ gzip: 339.73 kB │ map: 10,169.96 kB


✓ built in 18.84s


[postbuild] dist-electron/package.json already commonjs


[postbuild] ensured .cjs duplicates for 0 files


[launch] CI mode: build cached for subsequent tests

🧹 关闭 Electron 应用...


============================================================

🛡️ 安全 E2E 红线用例测试完成

============================================================

✅ 红线用例 1: 导航拦截（默认拒绝）

   - 外部导航 window.location.href 被拦截

   - 外部链接点击被拦截



✅ 红线用例 2: 窗口打开拦截（默认拒绝）

   - window.open() 被拦截

   - target="_blank" 链接被拦截



✅ 红线用例 3: 权限请求拒绝（默认拒绝）

   - 摄像头权限被拒绝

   - 麦克风权限被拒绝

   - 地理位置权限被拒绝

   - 通知权限被拒绝



🎯 验收标准：三条红线用例稳定通过 ✅

📋 基于：Electron 官方安全清单实现

============================================================

[2/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:73:3 › 🚫 红线用例 1: 导航拦截（默认拒绝） › 外部导航应被拦截 - 链接点击
[3/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:106:3 › 🚫 红线用例 2: 窗口打开拦截（默认拒绝） › window.open() 应被拦截
[4/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:163:3 › 🚫 红线用例 2: 窗口打开拦截（默认拒绝） › target="_blank" 链接应被拦截
[5/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:240:3 › 🚫 红线用例 3: 权限请求拒绝（默认拒绝） › 摄像头权限应被拒绝
[6/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:286:3 › 🚫 红线用例 3: 权限请求拒绝（默认拒绝） › 麦克风权限应被拒绝
[7/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:332:3 › 🚫 红线用例 3: 权限请求拒绝（默认拒绝） › 地理位置权限应被拒绝
[8/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:371:3 › 🚫 红线用例 3: 权限请求拒绝（默认拒绝） › 通知权限应被拒绝
[9/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:391:3 › 🛡️ 综合红线验证 › 三条红线用例稳定性测试
[10/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:487:3 › 🛡️ 综合红线验证 › 安全配置持久性验证
[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  suppress all logs with { quiet: true }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[11/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:43:3 › 🚫 红线用例 1: 导航拦截（默认拒绝） › 外部导航应被拦截 - window.location.href (retry #1)
🚀 启动 Electron 应用进行安全红线测试...

[launch] CI mode: reusing existing build (cached)

🧹 关闭 Electron 应用...


============================================================

🛡️ 安全 E2E 红线用例测试完成

============================================================

✅ 红线用例 1: 导航拦截（默认拒绝）

   - 外部导航 window.location.href 被拦截

   - 外部链接点击被拦截



✅ 红线用例 2: 窗口打开拦截（默认拒绝）

   - window.open() 被拦截

   - target="_blank" 链接被拦截



✅ 红线用例 3: 权限请求拒绝（默认拒绝）

   - 摄像头权限被拒绝

   - 麦克风权限被拒绝

   - 地理位置权限被拒绝

   - 通知权限被拒绝



🎯 验收标准：三条红线用例稳定通过 ✅

📋 基于：Electron 官方安全清单实现

============================================================

  1) [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:43:3 › 🚫 红线用例 1: 导航拦截（默认拒绝） › 外部导航应被拦截 - window.location.href 

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\security-redlines.spec.ts:26:31

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\security-redlines.spec.ts:26:31

    attachment #1: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results\artifacts\security-security-redlines-03a8c-应被拦截---window-location-href-electron-security-audit-retry1\trace.zip
    Usage:

        npx playwright show-trace test-results\artifacts\security-security-redlines-03a8c-应被拦截---window-location-href-electron-security-audit-retry1\trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[12/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:73:3 › 🚫 红线用例 1: 导航拦截（默认拒绝） › 外部导航应被拦截 - 链接点击 (retry #1)
[13/13] [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:106:3 › 🚫 红线用例 2: 窗口打开拦截（默认拒绝） › window.open() 应被拦截 (retry #1)
[14/13] (retries) [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:163:3 › 🚫 红线用例 2: 窗口打开拦截（默认拒绝） › target="_blank" 链接应被拦截 (retry #1)
[15/13] (retries) [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:240:3 › 🚫 红线用例 3: 权限请求拒绝（默认拒绝） › 摄像头权限应被拒绝 (retry #1)
[16/13] (retries) [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:286:3 › 🚫 红线用例 3: 权限请求拒绝（默认拒绝） › 麦克风权限应被拒绝 (retry #1)
[17/13] (retries) [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:332:3 › 🚫 红线用例 3: 权限请求拒绝（默认拒绝） › 地理位置权限应被拒绝 (retry #1)
[18/13] (retries) [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:371:3 › 🚫 红线用例 3: 权限请求拒绝（默认拒绝） › 通知权限应被拒绝 (retry #1)
[19/13] (retries) [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:391:3 › 🛡️ 综合红线验证 › 三条红线用例稳定性测试 (retry #1)
[20/13] (retries) [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:487:3 › 🛡️ 综合红线验证 › 安全配置持久性验证 (retry #1)
[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[21/13] (retries) [electron-security-audit] › tests\e2e\security\session-ready.spec.ts:4:1 › ADR-0002: defaultSession 仅在 ready 后访问，且首窗可打开
[electron-security-audit] › tests\e2e\security\session-ready.spec.ts:4:1 › ADR-0002: defaultSession 仅在 ready 后访问，且首窗可打开
[launch] CI mode: reusing existing build (cached)

[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  enable debug logging with { debug: true }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[22/13] (retries) [electron-security-audit] › tests\e2e\security\session-ready.spec.ts:4:1 › ADR-0002: defaultSession 仅在 ready 后访问，且首窗可打开 (retry #1)
[launch] CI mode: reusing existing build (cached)

  2) [electron-security-audit] › tests\e2e\security\session-ready.spec.ts:4:1 › ADR-0002: defaultSession 仅在 ready 后访问，且首窗可打开 

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\session-ready.spec.ts:8:38

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\session-ready.spec.ts:8:38

    attachment #1: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results\artifacts\security-session-ready-ADR-1b09c-Session-仅在-ready-后访问，且首窗可打开-electron-security-audit-retry1\trace.zip
    Usage:

        npx playwright show-trace test-results\artifacts\security-session-ready-ADR-1b09c-Session-仅在-ready-后访问，且首窗可打开-electron-security-audit-retry1\trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  override existing env vars with { override: true }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[23/13] (retries) [electron-security-audit] › tests\e2e\security\smoke-csp-header-or-meta.spec.ts:5:1 › CSP 以响应头或<meta>其一存在即可
[electron-security-audit] › tests\e2e\security\smoke-csp-header-or-meta.spec.ts:5:1 › CSP 以响应头或<meta>其一存在即可
[launch] CI mode: reusing existing build (cached)

[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: 🛠️  run anywhere with `dotenvx run -- yourcommand`

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[24/13] (retries) [electron-security-audit] › tests\e2e\security\smoke-csp-header-or-meta.spec.ts:5:1 › CSP 以响应头或<meta>其一存在即可 (retry #1)
[launch] CI mode: reusing existing build (cached)

  3) [electron-security-audit] › tests\e2e\security\smoke-csp-header-or-meta.spec.ts:5:1 › CSP 以响应头或<meta>其一存在即可 

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchAppWithPage (D:\a\myguild\myguild\tests\helpers\launch.ts:202:16)
        at D:\a\myguild\myguild\tests\e2e\security\smoke-csp-header-or-meta.spec.ts:7:31

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchAppWithPage (D:\a\myguild\myguild\tests\helpers\launch.ts:202:16)
        at D:\a\myguild\myguild\tests\e2e\security\smoke-csp-header-or-meta.spec.ts:7:31

    attachment #1: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results\artifacts\security-smoke-csp-header-or-meta-CSP-以响应头或-meta-其一存在即可-electron-security-audit-retry1\trace.zip
    Usage:

        npx playwright show-trace test-results\artifacts\security-smoke-csp-header-or-meta-CSP-以响应头或-meta-其一存在即可-electron-security-audit-retry1\trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: ⚙️  override existing env vars with { override: true }

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[25/13] (retries) [electron-security-audit] › tests\e2e\security-smoke.spec.ts:4:1 › 安全护栏生效（CSP & 禁用 Node）
[electron-security-audit] › tests\e2e\security-smoke.spec.ts:4:1 › 安全护栏生效（CSP & 禁用 Node）
[launch] CI mode: reusing existing build (cached)

[dotenv@17.2.1] injecting env (0) from .env.cache-bust -- tip: 🔐 encrypt with Dotenvx: https://dotenvx.com

[playwright-config] E2E_SECURITY_TIMEOUT_MS=300000

[playwright-config] PW_CACHE_BUST=git:b4cbaed5-pkg:1758271791-pw:1758295268-node:22.16

[26/13] (retries) [electron-security-audit] › tests\e2e\security-smoke.spec.ts:4:1 › 安全护栏生效（CSP & 禁用 Node） (retry #1)
[launch] CI mode: reusing existing build (cached)

  4) [electron-security-audit] › tests\e2e\security-smoke.spec.ts:4:1 › 安全护栏生效（CSP & 禁用 Node） ──────

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security-smoke.spec.ts:6:36

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────

    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security-smoke.spec.ts:6:36

    attachment #1: trace (application/zip) ─────────────────────────────────────────────────────────
    test-results\artifacts\security-smoke-安全护栏生效（CSP-禁用-Node）-electron-security-audit-retry1\trace.zip
    Usage:

        npx playwright show-trace test-results\artifacts\security-smoke-安全护栏生效（CSP-禁用-Node）-electron-security-audit-retry1\trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────


Error:   1) [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:43:3 › 🚫 红线用例 1: 导航拦截（默认拒绝） › 外部导航应被拦截 - window.location.href 
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\security-redlines.spec.ts:26:31
Error:   1) [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:43:3 › 🚫 红线用例 1: 导航拦截（默认拒绝） › 外部导航应被拦截 - window.location.href 

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\security-redlines.spec.ts:26:31
Error:   2) [electron-security-audit] › tests\e2e\security\session-ready.spec.ts:4:1 › ADR-0002: defaultSession 仅在 ready 后访问，且首窗可打开 
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\session-ready.spec.ts:8:38
Error:   2) [electron-security-audit] › tests\e2e\security\session-ready.spec.ts:4:1 › ADR-0002: defaultSession 仅在 ready 后访问，且首窗可打开 

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security\session-ready.spec.ts:8:38
Error:   3) [electron-security-audit] › tests\e2e\security\smoke-csp-header-or-meta.spec.ts:5:1 › CSP 以响应头或<meta>其一存在即可 
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchAppWithPage (D:\a\myguild\myguild\tests\helpers\launch.ts:202:16)
        at D:\a\myguild\myguild\tests\e2e\security\smoke-csp-header-or-meta.spec.ts:7:31
Error:   3) [electron-security-audit] › tests\e2e\security\smoke-csp-header-or-meta.spec.ts:5:1 › CSP 以响应头或<meta>其一存在即可 

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchAppWithPage (D:\a\myguild\myguild\tests\helpers\launch.ts:202:16)
        at D:\a\myguild\myguild\tests\e2e\security\smoke-csp-header-or-meta.spec.ts:7:31
Error:   4) [electron-security-audit] › tests\e2e\security-smoke.spec.ts:4:1 › 安全护栏生效（CSP & 禁用 Node） ──────
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security-smoke.spec.ts:6:36
Error:   4) [electron-security-audit] › tests\e2e\security-smoke.spec.ts:4:1 › 安全护栏生效（CSP & 禁用 Node） ──────

    Retry #1 ───────────────────────────────────────────────────────────────────────────────────────
    Error: Electron entry point not found at "dist/win-unpacked/ViteGame Studio.exe". Please build the application before running tests (npm run build) or set ELECTRON_MAIN_PATH environment variable to a valid path.

       at ..\helpers\launch.ts:25

      23 |
      24 |   if (!existsSync(entryPath)) {
    > 25 |     throw new Error(
         |           ^
      26 |       `Electron entry point not found at "${entryPath}". ` +
      27 |         `Please build the application before running tests (npm run build) ` +
      28 |         `or set ELECTRON_MAIN_PATH environment variable to a valid path.`
        at validateEntryPath (D:\a\myguild\myguild\tests\helpers\launch.ts:25:11)
        at launchApp (D:\a\myguild\myguild\tests\helpers\launch.ts:124:16)
        at D:\a\myguild\myguild\tests\e2e\security-smoke.spec.ts:6:36
Notice:   4 failed
    [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:43:3 › 🚫 红线用例 1: 导航拦截（默认拒绝） › 外部导航应被拦截 - window.location.href 
    [electron-security-audit] › tests\e2e\security\session-ready.spec.ts:4:1 › ADR-0002: defaultSession 仅在 ready 后访问，且首窗可打开 
    [electron-security-audit] › tests\e2e\security\smoke-csp-header-or-meta.spec.ts:5:1 › CSP 以响应头或<meta>其一存在即可 
    [electron-security-audit] › tests\e2e\security-smoke.spec.ts:4:1 › 安全护栏生效（CSP & 禁用 Node） ───────
  9 did not run
  4 failed
    [electron-security-audit] › tests\e2e\security\security-redlines.spec.ts:43:3 › 🚫 红线用例 1: 导航拦截（默认拒绝） › 外部导航应被拦截 - window.location.href 
    [electron-security-audit] › tests\e2e\security\session-ready.spec.ts:4:1 › ADR-0002: defaultSession 仅在 ready 后访问，且首窗可打开 
    [electron-security-audit] › tests\e2e\security\smoke-csp-header-or-meta.spec.ts:5:1 › CSP 以响应头或<meta>其一存在即可 
    [electron-security-audit] › tests\e2e\security-smoke.spec.ts:4:1 › 安全护栏生效（CSP & 禁用 Node） ───────
  9 did not run
Error: Process completed with exit code 1.