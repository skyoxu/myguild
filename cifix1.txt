è¿™æ‰¹æŠ¥é”™éƒ½æ˜¯ ShellCheck çš„é£æ ¼/ç¨³å¥æ€§æé†’ï¼ˆä¸æ˜¯ YAML è¯­æ³•äº†ï¼‰ï¼Œè§£å†³æ€è·¯å¾ˆé›†ä¸­ï¼š

SC2129ï¼šå¤šæ¬¡ >> file è¿½åŠ  â†’ ç”¨ ä¸€æ¬¡é‡å®šå‘çš„åˆ†ç»„ï¼š{ cmd1; cmd2; } >> "$file"ï¼ˆæ•ˆç‡æ›´å¥½ï¼Œä¹Ÿæ›´â€œactionlint å‹å¥½â€ï¼‰
shellcheck.net
Stack Overflow
Ask Ubuntu

SC2086ï¼šæ‰€æœ‰å˜é‡éƒ½ åŠ åŒå¼•å·ï¼Œé˜²æ­¢é€šé…/æ‹†è¯ï¼ˆglobbing & word splittingï¼‰
shellcheck.net

å‘è¿è¡Œæ‘˜è¦è¾“å‡º Markdownï¼šç»Ÿä¸€å†™åˆ° $GITHUB_STEP_SUMMARYï¼Œå¹¶æŠŠå¤šæ¡è¾“å‡ºæ”¾è¿›ä¸€æ¬¡åˆ†ç»„é‡Œï¼ˆå¯æ­é… heredocï¼‰
GitHub Docs
The GitHub Blog

ä¸‹é¢ç»™ä½ ä¸‰å¤„â€œå¯ç›´æ¥æ›¿æ¢â€çš„ run å—æ¨¡æ¿ï¼ˆæŠŠåŸæ¥çš„å¤šæ¬¡ echo >> "$GITHUB_STEP_SUMMARY" æ¢æ‰å³å¯ï¼‰ï¼Œå¹¶é¡ºæ‰‹æŠŠ SC2086 ä¸€èµ·æ¶ˆäº†ã€‚
1) .github/workflows/release-emergency-rollback.ymlï¼ˆè¡Œ 286 çš„ stepï¼‰
- name: Rollback summary
  if: always()
  shell: bash
  run: |
    summary_file="${GITHUB_STEP_SUMMARY}"
    {
      echo "## å›æ»šç»“æœæ€»ç»“"
      echo ""
      echo "- **ç›®æ ‡ç‰ˆæœ¬**: ${{ inputs.rollback_to }}"
      echo "- **å›æ»šçª—å£**: ${{ inputs.window }}"
      echo "- **è§¦å‘äºº**: ${{ github.actor }}"
      echo ""
      echo "### åç»­åŠ¨ä½œæ¸…å•"
      echo "1. ğŸ” ç«‹å³è°ƒæŸ¥æ ¹å› "
      echo "2. ğŸ§ª è¡¥å……å›å½’ç”¨ä¾‹"
      echo "3. ğŸ“ è¾“å‡ºå¤ç›˜è®°å½•"
    } >> "${summary_file}"


è¯´æ˜ï¼šæŠŠ å¤šæ¬¡è¿½åŠ åˆå¹¶æˆä¸€æ¬¡ { â€¦; } >> fileï¼ŒShellCheck å°±ä¸ä¼šå†æŠ¥ SC2129ï¼›æ‰€æœ‰å˜é‡å‡å·²åŒå¼•å·åŒ…è£¹ï¼Œé¿å… SC2086ã€‚$GITHUB_STEP_SUMMARY æ˜¯å®˜æ–¹æ”¯æŒçš„ Job Summary æ–‡ä»¶ï¼ŒåŸç”Ÿæ¸²æŸ“ Markdownã€‚
shellcheck.net
+1
GitHub Docs

2) .github/workflows/release-ramp.ymlï¼ˆè¡Œ 288 çš„ stepï¼‰
- name: Ramp summary
  shell: bash
  run: |
    summary_file="${GITHUB_STEP_SUMMARY}"
    {
      echo "## åˆ†é˜¶æ®µå‘å¸ƒç»“æœ"
      echo ""
      echo "- **ç›®æ ‡é˜¶æ®µ**: ${{ inputs.stage }}%"
      echo "- **å˜æ›´çª—å£**: ${{ inputs.window }}"
      echo "- **è§¦å‘äºº**: ${{ github.actor }}"
    } >> "${summary_file}"


è¯´æ˜ï¼šåŒæ ·ç”¨ åˆ†ç»„ä¸€æ¬¡é‡å®šå‘ ä»£æ›¿å¤šæ¬¡ >>ï¼›è¡¨è¾¾å¼ç”± Actions å…ˆå±•å¼€ï¼Œå†ä½œä¸ºå­—é¢ä¼ ç»™ Bashï¼Œæ˜¯å®˜æ–¹æ¨èçš„ç”¨æ³•ã€‚
GitHub Docs

3) .github/workflows/staged-release.ymlï¼ˆè¡Œ 406 çš„ stepï¼‰

ä½ è¿™é‡Œæ—¢æœ‰ SC2129 åˆæœ‰å¤šå¤„ SC2086ã€‚ç”¨ heredoc + ä¸€æ¬¡æ€§é‡å®šå‘æœ€å¹²å‡€ï¼š

- name: Generate staged plan & attach summary
  shell: bash
  run: |
    summary_file="${GITHUB_STEP_SUMMARY}"

    # ç”Ÿæˆå‘å¸ƒè®¡åˆ’æ–‡ä»¶ï¼ˆç¤ºä¾‹ï¼‰
    cat <<'PLAN' > release-plan.md
    | é˜¶æ®µ | æµé‡ | æ¡ä»¶ |
    |---|---|---|
    | 10% | 10min | æ— å‘Šè­¦ |
    | 25% | 20min | æ— å‘Šè­¦ |
    | 50% | 30min | æ— å‘Šè­¦ |
    PLAN

    {
      echo "## åˆ†é˜¶æ®µå‘å¸ƒè®¡åˆ’"
      cat "release-plan.md"
      echo ""
      echo "> è§¦å‘äºº: ${{ github.actor }} | è¿è¡Œ: ${{ github.run_id }}"
    } >> "${summary_file}"


å…³é”®ç‚¹ï¼š

heredoc å¼€å§‹/ç»“æŸæ ‡è®°åŒåˆ—ï¼Œæ•´æ®µåœ¨ run: | ä¸­ï¼›è¿™æ · YAML ä¸ Shell éƒ½æ­£ç¡®ã€‚

æ‰€æœ‰å˜é‡ï¼ˆåŒ…æ‹¬ summary_fileã€æ–‡ä»¶åç­‰ï¼‰ä¸€å¾‹åŠ åŒå¼•å·ï¼Œæ¸…ç©º SC2086ã€‚

ç”¨ { â€¦; } >> "${summary_file}" ä¸€æ¬¡é‡å®šå‘æ¸…ç©º SC2129ã€‚

Job Summary çš„ä½¿ç”¨æ˜¯å®˜æ–¹æ”¯æŒçš„æœ€ä½³å®è·µã€‚
GitHub Docs
+1

ä¸ºä»€ä¹ˆè¿™å°±èƒ½ä¸€æ¬¡è¿‡ï¼Ÿ

SC2129 å®˜æ–¹è§£é‡Šï¼šä¸å…¶æ¯è¡Œéƒ½ >> fileï¼ŒæŠŠå‘½ä»¤åˆ†ç»„åä¸€æ¬¡æ€§é‡å®šå‘ï¼Œå¼€é”€æ›´ä½ä¹Ÿæ›´æ¸…æ™°ï¼›æ­¤è§„åˆ™å±é£æ ¼çº§ï¼Œå¯ä¿®å¯å¿½ç•¥ï¼Œä½†ä¿®æ‰æœ€çœå¿ƒã€‚
shellcheck.net

SC2086 å®˜æ–¹è§£é‡Šï¼šåŒå¼•å·å¯é¿å…é€šé…ä¸æ‹†è¯ï¼›è‹¥ä½ ç¡®å®éœ€è¦æœ‰æ„æ‹†è¯ï¼Œè¯·ç”¨æ•°ç»„æˆ–æ˜¾å¼ read -raã€‚
shellcheck.net
Stack Overflow

Job Summaryï¼šGitHub åŸç”Ÿæ”¯æŒï¼Œå°† Markdown è¿½åŠ åˆ° "$GITHUB_STEP_SUMMARY" å³å¯åœ¨è¿è¡Œæ‘˜è¦é¡µæ¸²æŸ“ï¼›å¤šæ­¥å¯åå¤è¿½åŠ ã€‚
GitHub Docs
TIL

å°è´´å£«ï¼ˆå¯é€‰å¢å¼ºï¼‰

åœ¨è¿™äº› step çš„å¼€å¤´åŠ ä¸€è¡Œï¼šset -Eeuo pipefail æå‡è„šæœ¬ç¨³å¥æ€§ï¼ˆè‹¥è¿™æ ·åšï¼Œæ³¨æ„ç©ºå˜é‡éœ€è¦é»˜è®¤å€¼æˆ–æå‰èµ‹å€¼ï¼‰ã€‚

å¦‚æœä½ ä»æœ‰ å…¶ä»– step åœ¨ä¸€è¡Œä¸€è¡Œ >> "$GITHUB_STEP_SUMMARY"ï¼ŒåŒæ ·æ”¹æˆ { â€¦; } >> "$GITHUB_STEP_SUMMARY" å³å¯ä¸€ç½‘æ‰“å°½ SC2129