问题整理和原因分析

  1. GitHub Actions 构建错误

  原始问题URL: https://github.com/skyoxu/myguild/actions/runs/17916670149/job/50940563060

  错误信息: "format" is not exported by "__vite-browser-external"

  错误发生位置: build-artifacts job

  2. 根本原因分析

  核心问题: Electron进程隔离违规 - 渲染进程构建时包含了主进程Node.js模块

  技术细节:
  - src/main.tsx:6 (渲染进程入口) 导入 metrics-integration.ts
  - metrics-integration.ts:13-22 静态重导出主进程代码 sentry-main.ts
  - sentry-main.ts:2 使用 @sentry/electron/main (Node.js专用模块)
  - release-health.ts:1 也使用 @sentry/electron/main
  - Vite构建时尝试处理这些Node.js模块，导致 __vite-browser-external 错误

  进程架构违规示意:
  渲染进程 (Browser Context)
  ↓
  metrics-integration.ts (混合导出)
  ↓
  sentry-main.ts (@sentry/electron/main) ← Node.js模块
  release-health.ts (@sentry/electron/main) ← Node.js模块

  3. 发现的问题层次

  第一层: 静态重导出导致模块泄漏

  - metrics-integration.ts 无条件重导出主进程函数
  - 静态import/export在构建时被Vite处理，无法避免

  第二层: 多文件违规

  - sentry-main.ts
  - release-health.ts
  - 可能还有其他文件也违规

  第三层: 架构设计缺陷

  - 缺乏主进程/渲染进程严格分离
  - 集成文件试图同时服务两个进程

  4. commit 207febb 状态分析

  发现: commit 207febb本身就存在编译错误

  错误详情:
  src/shared/observability/metrics-integration.ts(28,3): error TS2305: Module '"./sentry-renderer"' has no exported member 'reportLevelLoadTime'.
  src/shared/observability/metrics-integration.ts(29,3): error TS2305: Module '"./sentry-renderer"' has no exported member 'reportBattleRoundTime'.

  问题分析:
  - metrics-integration.ts 尝试从 sentry-renderer.ts 导入不存在的函数
  - 可能是重构过程中的遗留问题
  - 说明这个commit并非"干净"状态

  5. 多层次问题总结

  | 问题层级 | 具体问题                 | 影响范围           |
  |------|----------------------|----------------|
  | 架构级  | Electron进程隔离违规       | 整个构建流程         |
  | 模块级  | 静态重导出Node.js模块到浏览器环境 | Vite构建失败       |
  | 代码级  | 函数导出不匹配              | TypeScript编译错误 |
  | 版本级  | commit历史中存在坏状态       | 回退无法解决问题       |

  6. 根因链

  GitHub Actions失败
  ↓
  Vite构建错误 (__vite-browser-external)
  ↓
  渲染进程包含Node.js模块
  ↓
  metrics-integration.ts静态重导出主进程代码
  ↓
  架构设计未严格分离主进程/渲染进程
  ↓
  可观测性系统试图统一初始化两个隔离的进程上下文

  7. 问题复杂度评估

  - 技术复杂度: 高 (涉及Electron架构、Vite构建、模块系统)
  - 影响范围: 广 (阻塞CI/CD流程)
  - 紧急程度: 高 (生产构建失败)
  - 修复风险: 中高 (需要重构可观测性架构)

● 问题和原因整理完成。核心发现是这是一个多层次的Electron进程隔离违规问题，不仅影响GitHub
  Actions构建，连commit历史中也存在编译错误，说明问题的复杂性和影响范围都比较大。