name: PR Status Gatekeeper - Windows CIå®ˆæŠ¤

# ä¸“æ³¨Windows CIçŽ¯å¢ƒçš„åˆ†æ”¯ä¿æŠ¤å®ˆé—¨å‘˜
# èšåˆæ‰€æœ‰å…³é”®ä½œä¸šçŠ¶æ€ï¼Œç®€åŒ–åˆ†æ”¯ä¿æŠ¤è§„åˆ™ç®¡ç†

on:
  pull_request:
    branches: [main, develop]
    types: [opened, synchronize, reopened, ready_for_review]

env:
  # å®ˆé—¨å‘˜è½»é‡çº§è¿è¡ŒçŽ¯å¢ƒ
  GATEKEEPER_TIMEOUT: 5

permissions:
  contents: read
  actions: read

# ==================== å¹¶å‘æŽ§åˆ¶ ====================
concurrency:
  group: gatekeeper-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # ==================== çŠ¶æ€æ£€æŸ¥èšåˆå™¨ ====================
  # æ­¤å·¥ä½œæµä½œä¸º"å®ˆé—¨å‘˜"ï¼Œç­‰å¾…å…¶ä»–å·¥ä½œæµä¸­çš„å…³é”®ä½œä¸šå®Œæˆ
  # GitHub Actionsä¼šè‡ªåŠ¨æ£€æµ‹åŒä¸€PRè§¦å‘çš„å…¶ä»–å·¥ä½œæµçŠ¶æ€

  windows-ci-gatekeeper:
    name: Windows CI Status Check
    runs-on: ubuntu-latest # è½»é‡çº§æ£€æŸ¥ä½¿ç”¨ä¾¿å®œrunner
    timeout-minutes: 30 # ç»™å…¶ä»–å·¥ä½œæµå……è¶³å®Œæˆæ—¶é—´

    # è·³è¿‡è‰ç¨¿PRä»¥ä¼˜åŒ–æ€§èƒ½
    if: github.event.pull_request.draft == false

    steps:
      - name: ðŸ“¥ æ£€å‡ºä»£ç ï¼ˆç”¨äºŽçŠ¶æ€æ£€æŸ¥ï¼‰
        uses: actions/checkout@v4

      - name: â³ ç­‰å¾…å…³é”®Windows CIå·¥ä½œæµå®Œæˆ
        uses: lewagon/wait-on-check-action@v1.3.4
        with:
          ref: ${{ github.ref }}
          check-name: Build and Test # build-and-test.ymlä¸­çš„ä½œä¸šå
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          wait-interval: 30

      - name: â³ ç­‰å¾…å®‰å…¨ç»Ÿä¸€æ£€æŸ¥å®Œæˆ
        uses: lewagon/wait-on-check-action@v1.3.4
        with:
          ref: ${{ github.ref }}
          check-name: ðŸš¦ ç»Ÿä¸€å®‰å…¨é—¨ç¦ # security-unified.ymlä¸­çš„ä½œä¸šå
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          wait-interval: 30

      - name: ðŸŽ¯ Windows CIçŠ¶æ€èšåˆæˆåŠŸ
        shell: bash
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          ## ðŸ›¡ï¸ PRå®ˆé—¨å‘˜æ£€æŸ¥å®Œæˆ

          ### âœ… Windows CIæ ¸å¿ƒä½œä¸šçŠ¶æ€
          - **æž„å»ºæµ‹è¯•**: âœ… é€šè¿‡ (Build and Test)
          - **å®‰å…¨ç»Ÿä¸€**: âœ… é€šè¿‡ (ðŸš¦ ç»Ÿä¸€å®‰å…¨é—¨ç¦)

          ### ðŸ“Š æ£€æŸ¥æ‘˜è¦
          - **çŽ¯å¢ƒ**: Windows-focused CI
          - **çŠ¶æ€**: æ‰€æœ‰å…³é”®æ£€æŸ¥å·²é€šè¿‡
          - **æ—¶é—´**: $(date -u '+%Y-%m-%d %H:%M:%S UTC')
          - **ä¼˜åŒ–**: P2é˜¶æ®µ - åˆ†æ”¯ä¿æŠ¤è§„åˆ™ç®€åŒ–

          ---
          *æ­¤æ£€æŸ¥èšåˆäº†æ‰€æœ‰å¿…éœ€çš„Windows CIä½œä¸šçŠ¶æ€ï¼Œå¯ä½œä¸ºåˆ†æ”¯ä¿æŠ¤çš„å•ä¸€æ£€æŸ¥ç‚¹*
          EOF

  # ==================== å¯é€‰å¢žå¼ºæ£€æŸ¥ ====================
  workflow-health-check:
    name: Workflow Health Check
    runs-on: ubuntu-latest # è½»é‡çº§æ£€æŸ¥å¯ç”¨æ›´ä¾¿å®œçš„runner
    timeout-minutes: 2

    steps:
      - name: ðŸ“‹ å®ˆé—¨å‘˜å¥åº·æ£€æŸ¥
        shell: bash
        run: |
          echo "## ðŸ” Gatekeeperå¥åº·çŠ¶æ€" >> $GITHUB_STEP_SUMMARY
          echo "- å·¥ä½œæµç‰ˆæœ¬: v1.0" >> $GITHUB_STEP_SUMMARY
          echo "- æ£€æŸ¥æ—¶é—´: $(date -u)" >> $GITHUB_STEP_SUMMARY
          echo "- ä¼˜åŒ–çŠ¶æ€: P2é˜¶æ®µå®Œæˆ" >> $GITHUB_STEP_SUMMARY
