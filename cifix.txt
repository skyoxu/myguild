npm warn config production Use `--omit=dev` instead.
npm warn config cache-min This option has been deprecated in favor of `--prefer-offline`.

> gamedev-vitegame@0.1.1 test:unit
> vitest run


 RUN  v3.2.4 /home/runner/work/myguild/myguild

stdout | tests/unit/metrics.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | tests/unit/repos.contract.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | tests/unit/risk.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì tests/unit/metrics.spec.ts (40 tests) 23ms
 ‚úì tests/unit/risk.spec.ts (29 tests) 30ms
 ‚úì tests/unit/repos.contract.spec.ts (33 tests) 48ms
stdout | tests/unit/glossary.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | src/shared/adapters/sqlite.bak/__tests__/config-manager.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | tests/unit/guild-manager-chunk-001.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì tests/unit/glossary.spec.ts (40 tests) 39ms
 ‚úì src/shared/adapters/sqlite.bak/__tests__/config-manager.spec.ts (33 tests) 32ms
 ‚úì tests/unit/guild-manager-chunk-001.spec.ts (31 tests) 21ms
stdout | tests/unit/guild-manager-chunk-002.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | tests/unit/guild-manager/guild-core.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | tests/unit/release.feed.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì tests/unit/guild-manager/guild-core.spec.ts (32 tests) 28ms
 ‚úì tests/unit/guild-manager-chunk-002.spec.ts (17 tests) 384ms
stdout | tests/unit/runtime.budget.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì tests/unit/runtime.budget.spec.ts (27 tests) 11ms
 ‚úì tests/unit/release.feed.spec.ts (13 tests) 1037ms
stdout | src/shared/contracts/events.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì src/shared/contracts/events.spec.ts (17 tests) 19ms
stdout | src/shared/services/__tests__/event-bus.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì src/shared/services/__tests__/event-bus.spec.ts (23 tests) 17ms
stdout | tests/unit/contracts/cloudevents.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì tests/unit/contracts/cloudevents.spec.ts (17 tests) 24ms
stdout | src/game/__tests__/GameStateManager.test.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì src/game/__tests__/GameStateManager.test.ts (21 tests) 129ms
stdout | tests/unit/middleware/cloudevents-validation.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì tests/unit/middleware/cloudevents-validation.spec.ts (20 tests) 30ms
stdout | tests/unit/gates.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì tests/unit/gates.spec.ts (16 tests) 14ms
stdout | tests/unit/db.checkpoint.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | src/tests/docs-scorer-performance.test.js
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | src/core/events/bus.test.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì tests/unit/db.checkpoint.spec.ts (7 tests | 1 skipped) 469ms
 ‚úì src/core/events/bus.test.ts (19 tests) 196ms
 ‚úì src/tests/docs-scorer-performance.test.js (6 tests) 492ms
stdout | src/game/__tests__/GameEngineAdapter.test.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | src/shared/middleware/__tests__/cloud-events-validator.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì src/shared/middleware/__tests__/cloud-events-validator.spec.ts (19 tests) 12ms
 ‚úì src/game/__tests__/GameEngineAdapter.test.ts (14 tests) 168ms
stdout | tests/unit/db.backup.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

{"timestamp":"2025-09-06T06:09:31.951Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}
{"timestamp":"2025-09-06T06:09:32.026Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}
 ‚ùØ tests/unit/db.backup.spec.ts (6 tests | 5 failed) 524ms
   √ó backup creates a valid sqlite file 72ms
     ‚Üí Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup
   √ó VACUUM INTO mode creates compressed backup 70ms
     ‚Üí Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=vacuum
   √ó backup handles concurrent access gracefully 187ms
     ‚Üí Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups-0 --mode=backup
{"timestamp":"2025-09-06T06:09:32.102Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

   √ó checkpoint integration with backup workflow 58ms
     ‚Üí Command failed: node scripts/db/checkpoint.mjs --database=test-data/test-app.db --truncate --verbose
üîÑ ÊâßË°å WAL checkpoint (TRUNCATE Ê®°Âºè)...
üìÅ Êï∞ÊçÆÂ∫ì: test-data/test-app.db
{
  "ok": false,
  "error": "file is not a database",
  "timestamp": "2025-09-06T06:09:32.277Z",
  "database": "test-data/test-app.db"
}

   ‚úì backup error handling and validation 91ms
   √ó backup script JSON output format 44ms
     ‚Üí Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup --json
{"timestamp":"2025-09-06T06:09:32.411Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

stdout | tests/unit/perf.budget.spec.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì tests/unit/perf.budget.spec.ts (17 tests) 14ms
stdout | src/game/__tests__/SceneManager.test.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì src/game/__tests__/SceneManager.test.ts (18 tests) 216ms
stdout | src/__tests__/p95-sampling-demo.test.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | src/__tests__/performance-utils.test.ts
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

stdout | src/App.test.tsx
üß™ Vitest ÊµãËØïÁéØÂ¢ÉÂ∑≤ÂàùÂßãÂåñ

 ‚úì src/App.test.tsx (6 tests) 225ms
 ‚úì src/__tests__/p95-sampling-demo.test.ts (4 tests) 6ms
 ‚úì src/__tests__/performance-utils.test.ts (8 tests) 147ms

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 5 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  tests/unit/db.backup.spec.ts > backup creates a valid sqlite file
Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup
 ‚ùØ tests/unit/db.backup.spec.ts:93:3
     91| 
     92| test.skipIf(!isSQLite3Available())('backup creates a valid sqlite file‚Ä¶
     93|   execSync(
       |   ^
     94|     `node scripts/db/backup-cli.mjs ${TEST_DB_PATH} ${TEST_BACKUP_DIR}‚Ä¶
     95|     { stdio: 'inherit', timeout: 30000 } // Êï∞ÊçÆÂ∫ìÊìç‰Ωú30sË∂ÖÊó∂

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/5]‚éØ

 FAIL  tests/unit/db.backup.spec.ts > VACUUM INTO mode creates compressed backup
Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=vacuum
 ‚ùØ tests/unit/db.backup.spec.ts:112:5
    110|   () => {
    111|     // ÊµãËØï VACUUM INTO Ê®°ÂºèÔºàÈÄÇÂêà‚ÄúÂÜ∑Â§á/ËΩªÂÜô‚ÄùÁ™óÂè£Ôºâ
    112|     execSync(
       |     ^
    113|       `node scripts/db/backup-cli.mjs ${TEST_DB_PATH} ${TEST_BACKUP_DI‚Ä¶
    114|       { stdio: 'inherit', timeout: 45000 } // VACUUMÊìç‰ΩúÊõ¥ÊÖ¢Ôºå45sË∂ÖÊó∂

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/5]‚éØ

 FAIL  tests/unit/db.backup.spec.ts > backup handles concurrent access gracefully
Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups-0 --mode=backup
{"timestamp":"2025-09-06T06:09:32.102Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

 ‚ùØ tests/unit/db.backup.spec.ts:147:13
    145|         new Promise<void>((resolve, reject) => {
    146|           try {
    147|             execSync(
       |             ^
    148|               `node scripts/db/backup-cli.mjs ${TEST_DB_PATH} ${concur‚Ä¶
    149|               { stdio: 'pipe', timeout: 15000 } // Âçï‰∏™Âπ∂ÂèëÊìç‰Ωú15sË∂ÖÊó∂
 ‚ùØ tests/unit/db.backup.spec.ts:145:9

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/5]‚éØ

 FAIL  tests/unit/db.backup.spec.ts > checkpoint integration with backup workflow
Error: Command failed: node scripts/db/checkpoint.mjs --database=test-data/test-app.db --truncate --verbose
üîÑ ÊâßË°å WAL checkpoint (TRUNCATE Ê®°Âºè)...
üìÅ Êï∞ÊçÆÂ∫ì: test-data/test-app.db
{
  "ok": false,
  "error": "file is not a database",
  "timestamp": "2025-09-06T06:09:32.277Z",
  "database": "test-data/test-app.db"
}

 ‚ùØ tests/unit/db.backup.spec.ts:171:30
    169| 
    170|     // 1. ÊâßË°å checkpoint Êìç‰Ωú
    171|     const checkpointResult = execSync(
       |                              ^
    172|       `node scripts/db/checkpoint.mjs --database=${TEST_DB_PATH} --tru‚Ä¶
    173|       { encoding: 'utf8', stdio: 'pipe' }

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/5]‚éØ

 FAIL  tests/unit/db.backup.spec.ts > backup script JSON output format
Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup --json
{"timestamp":"2025-09-06T06:09:32.411Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

 ‚ùØ tests/unit/db.backup.spec.ts:240:18
    238| test.skipIf(!isSQLite3Available())('backup script JSON output format',‚Ä¶
    239|   // ÊµãËØïÂ§á‰ªΩËÑöÊú¨ÁöÑ JSON ËæìÂá∫Ê†ºÂºèÔºàÁî®‰∫é CI ÈõÜÊàêÔºâ
    240|   const result = execSync(
       |                  ^
    241|     `node scripts/db/backup-cli.mjs ${TEST_DB_PATH} ${TEST_BACKUP_DIR}‚Ä¶
    242|     { encoding: 'utf8', stdio: 'pipe' }

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/5]‚éØ


 Test Files  1 failed | 26 passed (27)
      Tests  5 failed | 527 passed | 1 skipped (533)
   Start at  06:09:22
   Duration  11.73s (transform 1.08s, setup 4.74s, collect 3.68s, tests 4.35s, environment 14.77s, prepare 2.88s)


Error: Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup
 ‚ùØ tests/unit/db.backup.spec.ts:93:3

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ
Serialized Error: { status: 1, signal: null, output: [ null, null, null ], pid: 3417, stdout: null, stderr: null }


Error: Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=vacuum
 ‚ùØ tests/unit/db.backup.spec.ts:112:5

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ
Serialized Error: { status: 1, signal: null, output: [ null, null, null ], pid: 3433, stdout: null, stderr: null }


Error: Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups-0 --mode=backup
{"timestamp":"2025-09-06T06:09:32.102Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

 ‚ùØ tests/unit/db.backup.spec.ts:147:13
 ‚ùØ tests/unit/db.backup.spec.ts:145:9

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ
Serialized Error: { status: 1, signal: null, output: [ null, '<Buffer(0) ...>', '<Buffer(331) ...>' ], pid: 3449, stdout: '<Buffer(0) ...>', stderr: '<Buffer(331) ...>' }


Error: Error: Command failed: node scripts/db/checkpoint.mjs --database=test-data/test-app.db --truncate --verbose
üîÑ ÊâßË°å WAL checkpoint (TRUNCATE Ê®°Âºè)...
üìÅ Êï∞ÊçÆÂ∫ì: test-data/test-app.db
{
  "ok": false,
  "error": "file is not a database",
  "timestamp": "2025-09-06T06:09:32.277Z",
  "database": "test-data/test-app.db"
}

 ‚ùØ tests/unit/db.backup.spec.ts:171:30

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ
Serialized Error: { status: 1, signal: null, output: [ null, '', 'üîÑ ÊâßË°å WAL checkpoint (TRUNCATE Ê®°Âºè)...\nüìÅ Êï∞ÊçÆÂ∫ì: test-data/test-app.db\n{\n  "ok": false,\n  "error": "file is not a database",\n  "timestamp": "2025-09-06T06:09:32.277Z",\n  "database": "test-data/test-app.db"\n}\n' ], pid: 3493, stdout: '', stderr: 'üîÑ ÊâßË°å WAL checkpoint (TRUNCATE Ê®°Âºè)...\nüìÅ Êï∞ÊçÆÂ∫ì: test-data/test-app.db\n{\n  "ok": false,\n  "error": "file is not a database",\n  "timestamp": "2025-09-06T06:09:32.277Z",\n  "database": "test-data/test-app.db"\n}\n' }


Error: Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup --json
{"timestamp":"2025-09-06T06:09:32.411Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

 ‚ùØ tests/unit/db.backup.spec.ts:240:18

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ
Serialized Error: { status: 1, signal: null, output: [ null, '', '{"timestamp":"2025-09-06T06:09:32.411Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}\n' ], pid: 3537, stdout: '', stderr: '{"timestamp":"2025-09-06T06:09:32.411Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}\n' }

Error: Process completed with exit code 1.