npm warn config production Use `--omit=dev` instead.
npm warn config cache-min This option has been deprecated in favor of `--prefer-offline`.

> gamedev-vitegame@0.1.1 test:unit
> vitest run


 RUN  v3.2.4 /home/runner/work/myguild/myguild

stdout | tests/unit/metrics.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | tests/unit/repos.contract.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | tests/unit/risk.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ tests/unit/metrics.spec.ts (40 tests) 23ms
 âœ“ tests/unit/risk.spec.ts (29 tests) 30ms
 âœ“ tests/unit/repos.contract.spec.ts (33 tests) 48ms
stdout | tests/unit/glossary.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | src/shared/adapters/sqlite.bak/__tests__/config-manager.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | tests/unit/guild-manager-chunk-001.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ tests/unit/glossary.spec.ts (40 tests) 39ms
 âœ“ src/shared/adapters/sqlite.bak/__tests__/config-manager.spec.ts (33 tests) 32ms
 âœ“ tests/unit/guild-manager-chunk-001.spec.ts (31 tests) 21ms
stdout | tests/unit/guild-manager-chunk-002.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | tests/unit/guild-manager/guild-core.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | tests/unit/release.feed.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ tests/unit/guild-manager/guild-core.spec.ts (32 tests) 28ms
 âœ“ tests/unit/guild-manager-chunk-002.spec.ts (17 tests) 384ms
stdout | tests/unit/runtime.budget.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ tests/unit/runtime.budget.spec.ts (27 tests) 11ms
 âœ“ tests/unit/release.feed.spec.ts (13 tests) 1037ms
stdout | src/shared/contracts/events.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ src/shared/contracts/events.spec.ts (17 tests) 19ms
stdout | src/shared/services/__tests__/event-bus.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ src/shared/services/__tests__/event-bus.spec.ts (23 tests) 17ms
stdout | tests/unit/contracts/cloudevents.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ tests/unit/contracts/cloudevents.spec.ts (17 tests) 24ms
stdout | src/game/__tests__/GameStateManager.test.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ src/game/__tests__/GameStateManager.test.ts (21 tests) 129ms
stdout | tests/unit/middleware/cloudevents-validation.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ tests/unit/middleware/cloudevents-validation.spec.ts (20 tests) 30ms
stdout | tests/unit/gates.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ tests/unit/gates.spec.ts (16 tests) 14ms
stdout | tests/unit/db.checkpoint.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | src/tests/docs-scorer-performance.test.js
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | src/core/events/bus.test.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ tests/unit/db.checkpoint.spec.ts (7 tests | 1 skipped) 469ms
 âœ“ src/core/events/bus.test.ts (19 tests) 196ms
 âœ“ src/tests/docs-scorer-performance.test.js (6 tests) 492ms
stdout | src/game/__tests__/GameEngineAdapter.test.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | src/shared/middleware/__tests__/cloud-events-validator.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ src/shared/middleware/__tests__/cloud-events-validator.spec.ts (19 tests) 12ms
 âœ“ src/game/__tests__/GameEngineAdapter.test.ts (14 tests) 168ms
stdout | tests/unit/db.backup.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

{"timestamp":"2025-09-06T06:09:31.951Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}
{"timestamp":"2025-09-06T06:09:32.026Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}
 â¯ tests/unit/db.backup.spec.ts (6 tests | 5 failed) 524ms
   Ã— backup creates a valid sqlite file 72ms
     â†’ Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup
   Ã— VACUUM INTO mode creates compressed backup 70ms
     â†’ Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=vacuum
   Ã— backup handles concurrent access gracefully 187ms
     â†’ Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups-0 --mode=backup
{"timestamp":"2025-09-06T06:09:32.102Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

   Ã— checkpoint integration with backup workflow 58ms
     â†’ Command failed: node scripts/db/checkpoint.mjs --database=test-data/test-app.db --truncate --verbose
ğŸ”„ æ‰§è¡Œ WAL checkpoint (TRUNCATE æ¨¡å¼)...
ğŸ“ æ•°æ®åº“: test-data/test-app.db
{
  "ok": false,
  "error": "file is not a database",
  "timestamp": "2025-09-06T06:09:32.277Z",
  "database": "test-data/test-app.db"
}

   âœ“ backup error handling and validation 91ms
   Ã— backup script JSON output format 44ms
     â†’ Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup --json
{"timestamp":"2025-09-06T06:09:32.411Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

stdout | tests/unit/perf.budget.spec.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ tests/unit/perf.budget.spec.ts (17 tests) 14ms
stdout | src/game/__tests__/SceneManager.test.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ src/game/__tests__/SceneManager.test.ts (18 tests) 216ms
stdout | src/__tests__/p95-sampling-demo.test.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | src/__tests__/performance-utils.test.ts
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

stdout | src/App.test.tsx
ğŸ§ª Vitest æµ‹è¯•ç¯å¢ƒå·²åˆå§‹åŒ–

 âœ“ src/App.test.tsx (6 tests) 225ms
 âœ“ src/__tests__/p95-sampling-demo.test.ts (4 tests) 6ms
 âœ“ src/__tests__/performance-utils.test.ts (8 tests) 147ms

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 5 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/unit/db.backup.spec.ts > backup creates a valid sqlite file
Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup
 â¯ tests/unit/db.backup.spec.ts:93:3
     91| 
     92| test.skipIf(!isSQLite3Available())('backup creates a valid sqlite fileâ€¦
     93|   execSync(
       |   ^
     94|     `node scripts/db/backup-cli.mjs ${TEST_DB_PATH} ${TEST_BACKUP_DIR}â€¦
     95|     { stdio: 'inherit', timeout: 30000 } // æ•°æ®åº“æ“ä½œ30sè¶…æ—¶

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/5]â¯

 FAIL  tests/unit/db.backup.spec.ts > VACUUM INTO mode creates compressed backup
Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=vacuum
 â¯ tests/unit/db.backup.spec.ts:112:5
    110|   () => {
    111|     // æµ‹è¯• VACUUM INTO æ¨¡å¼ï¼ˆé€‚åˆâ€œå†·å¤‡/è½»å†™â€çª—å£ï¼‰
    112|     execSync(
       |     ^
    113|       `node scripts/db/backup-cli.mjs ${TEST_DB_PATH} ${TEST_BACKUP_DIâ€¦
    114|       { stdio: 'inherit', timeout: 45000 } // VACUUMæ“ä½œæ›´æ…¢ï¼Œ45sè¶…æ—¶

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/5]â¯

 FAIL  tests/unit/db.backup.spec.ts > backup handles concurrent access gracefully
Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups-0 --mode=backup
{"timestamp":"2025-09-06T06:09:32.102Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

 â¯ tests/unit/db.backup.spec.ts:147:13
    145|         new Promise<void>((resolve, reject) => {
    146|           try {
    147|             execSync(
       |             ^
    148|               `node scripts/db/backup-cli.mjs ${TEST_DB_PATH} ${concurâ€¦
    149|               { stdio: 'pipe', timeout: 15000 } // å•ä¸ªå¹¶å‘æ“ä½œ15sè¶…æ—¶
 â¯ tests/unit/db.backup.spec.ts:145:9

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/5]â¯

 FAIL  tests/unit/db.backup.spec.ts > checkpoint integration with backup workflow
Error: Command failed: node scripts/db/checkpoint.mjs --database=test-data/test-app.db --truncate --verbose
ğŸ”„ æ‰§è¡Œ WAL checkpoint (TRUNCATE æ¨¡å¼)...
ğŸ“ æ•°æ®åº“: test-data/test-app.db
{
  "ok": false,
  "error": "file is not a database",
  "timestamp": "2025-09-06T06:09:32.277Z",
  "database": "test-data/test-app.db"
}

 â¯ tests/unit/db.backup.spec.ts:171:30
    169| 
    170|     // 1. æ‰§è¡Œ checkpoint æ“ä½œ
    171|     const checkpointResult = execSync(
       |                              ^
    172|       `node scripts/db/checkpoint.mjs --database=${TEST_DB_PATH} --truâ€¦
    173|       { encoding: 'utf8', stdio: 'pipe' }

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/5]â¯

 FAIL  tests/unit/db.backup.spec.ts > backup script JSON output format
Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup --json
{"timestamp":"2025-09-06T06:09:32.411Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

 â¯ tests/unit/db.backup.spec.ts:240:18
    238| test.skipIf(!isSQLite3Available())('backup script JSON output format',â€¦
    239|   // æµ‹è¯•å¤‡ä»½è„šæœ¬çš„ JSON è¾“å‡ºæ ¼å¼ï¼ˆç”¨äº CI é›†æˆï¼‰
    240|   const result = execSync(
       |                  ^
    241|     `node scripts/db/backup-cli.mjs ${TEST_DB_PATH} ${TEST_BACKUP_DIR}â€¦
    242|     { encoding: 'utf8', stdio: 'pipe' }

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/5]â¯


 Test Files  1 failed | 26 passed (27)
      Tests  5 failed | 527 passed | 1 skipped (533)
   Start at  06:09:22
   Duration  11.73s (transform 1.08s, setup 4.74s, collect 3.68s, tests 4.35s, environment 14.77s, prepare 2.88s)


Error: Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup
 â¯ tests/unit/db.backup.spec.ts:93:3

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯
Serialized Error: { status: 1, signal: null, output: [ null, null, null ], pid: 3417, stdout: null, stderr: null }


Error: Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=vacuum
 â¯ tests/unit/db.backup.spec.ts:112:5

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯
Serialized Error: { status: 1, signal: null, output: [ null, null, null ], pid: 3433, stdout: null, stderr: null }


Error: Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups-0 --mode=backup
{"timestamp":"2025-09-06T06:09:32.102Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

 â¯ tests/unit/db.backup.spec.ts:147:13
 â¯ tests/unit/db.backup.spec.ts:145:9

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯
Serialized Error: { status: 1, signal: null, output: [ null, '<Buffer(0) ...>', '<Buffer(331) ...>' ], pid: 3449, stdout: '<Buffer(0) ...>', stderr: '<Buffer(331) ...>' }


Error: Error: Command failed: node scripts/db/checkpoint.mjs --database=test-data/test-app.db --truncate --verbose
ğŸ”„ æ‰§è¡Œ WAL checkpoint (TRUNCATE æ¨¡å¼)...
ğŸ“ æ•°æ®åº“: test-data/test-app.db
{
  "ok": false,
  "error": "file is not a database",
  "timestamp": "2025-09-06T06:09:32.277Z",
  "database": "test-data/test-app.db"
}

 â¯ tests/unit/db.backup.spec.ts:171:30

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯
Serialized Error: { status: 1, signal: null, output: [ null, '', 'ğŸ”„ æ‰§è¡Œ WAL checkpoint (TRUNCATE æ¨¡å¼)...\nğŸ“ æ•°æ®åº“: test-data/test-app.db\n{\n  "ok": false,\n  "error": "file is not a database",\n  "timestamp": "2025-09-06T06:09:32.277Z",\n  "database": "test-data/test-app.db"\n}\n' ], pid: 3493, stdout: '', stderr: 'ğŸ”„ æ‰§è¡Œ WAL checkpoint (TRUNCATE æ¨¡å¼)...\nğŸ“ æ•°æ®åº“: test-data/test-app.db\n{\n  "ok": false,\n  "error": "file is not a database",\n  "timestamp": "2025-09-06T06:09:32.277Z",\n  "database": "test-data/test-app.db"\n}\n' }


Error: Error: Command failed: node scripts/db/backup-cli.mjs test-data/test-app.db ./test-backups --mode=backup --json
{"timestamp":"2025-09-06T06:09:32.411Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}

 â¯ tests/unit/db.backup.spec.ts:240:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯
Serialized Error: { status: 1, signal: null, output: [ null, '', '{"timestamp":"2025-09-06T06:09:32.411Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}\n' ], pid: 3537, stdout: '', stderr: '{"timestamp":"2025-09-06T06:09:32.411Z","level":"error","message":"SQLite3 command line tool not found. Please install sqlite3.","meta":{"error":"Command failed: \"/home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe\" --version\n/bin/sh: 1: /home/runner/work/myguild/myguild/tools/sqlite/sqlite3.exe: Permission denied\n"}}\n' }

Error: Process completed with exit code 1.